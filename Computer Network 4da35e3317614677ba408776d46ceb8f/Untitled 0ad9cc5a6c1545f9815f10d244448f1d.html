<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>第二章 应用层</title><style>
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}
.select-value-color-default { background-color: rgba(206,205,202,0.5); }
.select-value-color-gray { background-color: rgba(155,154,151, 0.4); }
.select-value-color-brown { background-color: rgba(140,46,0,0.2); }
.select-value-color-orange { background-color: rgba(245,93,0,0.2); }
.select-value-color-yellow { background-color: rgba(233,168,0,0.2); }
.select-value-color-green { background-color: rgba(0,135,107,0.2); }
.select-value-color-blue { background-color: rgba(0,120,223,0.2); }
.select-value-color-purple { background-color: rgba(103,36,222,0.2); }
.select-value-color-pink { background-color: rgba(221,0,129,0.2); }
.select-value-color-red { background-color: rgba(255,0,26,0.2); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="0ad9cc5a-6c15-45f9-815f-10d244448f1d" class="page sans"><header><img class="page-cover-image" src="https://www.notion.so/images/page-cover/woodcuts_7.jpg" style="object-position:center 70%"/><div class="page-header-icon page-header-icon-with-cover"><span class="icon">📌</span></div><h1 class="page-title">第二章 应用层</h1></header><div class="page-body"><h1 id="a6dfe57a-3891-4aeb-95e5-e028a5d7fbd0" class="">一、网络应用原理</h1><ul id="521d108c-0953-4128-acfd-93609bac7f8c" class="toggle"><li><details open=""><summary>网络应用的创建</summary><ul id="0ca5a1b8-cc38-44dd-a3c8-236e73d622bf" class="bulleted-list"><li>编写在不同的<strong>终端系统(网络边缘)</strong>上运行并通过网络进行通信的程序。</li></ul><ul id="4e6e00e4-6821-487d-a5c2-6af7decec354" class="bulleted-list"><li>例如，Web：Web 服务器软件与浏览器软件通信</li></ul><p id="58906b16-adad-455b-8d50-f8c977f29fb6" class="">注意<div class="indented"><ul id="7f59b27c-d305-4ba2-ab0d-4331775fbde5" class="bulleted-list"><li>无需为网络核心设备编写软件</li></ul><ul id="7f71be7d-131e-4ffb-9491-949dd54f328e" class="bulleted-list"><li>网络核心设备不会运行<mark class="highlight-red">用户应用程序</mark></li></ul></div></p></details></li></ul><ul id="c919b1ca-1a9f-4310-92ad-b56b12821bb7" class="toggle"><li><details open=""><summary>应用架构</summary><ul id="bbe907d8-5bad-4561-957a-a792480d78a2" class="toggle"><li><details open=""><summary>Client-server：C/S 架构</summary><ul id="7def760d-db53-4482-b935-b04f3a5ce191" class="bulleted-list"><li>服务器<strong>：</strong><ul id="d3c8abc3-f813-41cf-b8a8-7a9392d24793" class="bulleted-list"><li>永远在线的主机</li></ul><ul id="15acdf3b-41ea-4b84-9367-e021071ec315" class="bulleted-list"><li>具有永久 IP 地址</li></ul><ul id="a8e7de1d-855c-4734-8a2c-2cc8ea640011" class="bulleted-list"><li>服务器场以进行扩展,大批量的服务</li></ul></li></ul><ul id="560f8d44-650c-4132-8c95-4b9a23d988aa" class="bulleted-list"><li>客户：<ul id="5ace204b-356e-4c72-8897-ef5073debd56" class="bulleted-list"><li>与服务器通讯</li></ul><ul id="db3dfb19-f2ae-4cc5-beca-4f06a21b199a" class="bulleted-list"><li>可能断断续续地与服务器连接</li></ul><ul id="463fa5b0-98ed-4559-935d-a670a57d3673" class="bulleted-list"><li>可能具有动态 IP 地址</li></ul><ul id="aaa6f65b-41ce-472d-9866-0a18324608e9" class="bulleted-list"><li>客户端之间不能直接互相交流</li></ul></li></ul></details></li></ul><ul id="1133bd60-bed8-4610-9ab4-2daf98a6e179" class="toggle"><li><details open=""><summary>Peer-to-peer：P2P</summary><ul id="340a033b-5e34-4097-bdc0-54f078a9efbe" class="bulleted-list"><li>没有永远在线的服务器，完全对等</li></ul><ul id="ecb39593-2baf-4633-aaee-4cde6b9105f2" class="bulleted-list"><li>任意终端系统直接通信<ul id="c576b5b9-9aec-4889-8333-a9d549d1054d" class="bulleted-list"><li>任意两个系统都可以在对等网络中通信，不依赖于 C/S 架构中的服务器架构；</li></ul><ul id="b834ae49-7044-4f37-8c05-3aaf330057fc" class="bulleted-list"><li>任意一个系统既可以提供服务，也可以享受服务；</li></ul></li></ul><ul id="5ef1f07f-9bba-4e5a-a72e-ec08c365db68" class="bulleted-list"><li>对等方向其他对等方请求服务，向其他对等方提供服务<ul id="a8302d1e-ffc8-4ee1-becf-33e8324fb37e" class="bulleted-list"><li>自我扩展性：新的同伴带来新的服务能力和新的服务需求</li></ul></li></ul><ul id="d06a59d4-66fb-4be5-ba96-29822b03213d" class="bulleted-list"><li>对等体间歇连接并更改 IP 地址(动态 IP 地址)<ul id="c9429396-a18c-46fa-9610-6ce3a28e929b" class="bulleted-list"><li>复杂的管理</li></ul></li></ul></details></li></ul><ul id="6714f676-c8fd-4c68-9e53-b2a3ddb8ebf4" class="toggle"><li><details open=""><summary>C/S 架构和 P2P 架构的混合体</summary><ul id="f05e6712-dc61-4227-9d46-6b3cdc5853c7" class="bulleted-list"><li>以 Skype 为例---Skype 的 IP 语音 P2P 应用<ul id="19550d69-18b2-4dcc-838d-8009978376c4" class="bulleted-list"><li>集中服务器：存储用户信息(IP 地址等)，</li></ul><ul id="12e6c919-b45b-4fed-833b-4822c956c45b" class="bulleted-list"><li>客户端-客户端连接：直接（不通过服务器），聊天过程是 P2P 的直接通信方式</li></ul></li></ul><ul id="62f404ea-ff8a-444a-9507-8724ebfc1fbf" class="bulleted-list"><li>两个用户之间的即时消息聊天是 P2P</li></ul><ul id="774fbb37-896b-4317-a9ba-97e8224b8b75" class="bulleted-list"><li>用户上线时在中央服务器上注册其 IP 地址，当用户要进行通信时，联系中央服务器以查找好友的 IP 地址</li></ul></details></li></ul></details></li></ul><ul id="bb91914c-b9ea-44b3-a8ce-ae8dda34e6c7" class="toggle"><li><details open=""><summary>进程通信</summary><ol id="183e6c4a-dd5c-44f4-9505-c5e195b2e978" class="numbered-list" start="1"><li>定义<ul id="0ce5d06b-b1f0-4390-9241-50cc1780c029" class="bulleted-list"><li>进程：在主机中运行的计算机程序；</li></ul><ul id="84d44e82-43bc-4870-a3c2-c6db1568f30d" class="bulleted-list"><li>在同一主机中，两个不同进程使用进程间通信进行通信，其由 OS 定义</li></ul><ul id="365037bf-dbc0-43fd-86a0-9ca873b1341a" class="bulleted-list"><li>不同主机中的进程通过交换消息进行通信，由网络协议定义，<strong>通过传输层的端口号进行不同主机的进程寻址</strong></li></ul><ul id="7ea1edb3-d56c-4c00-97b7-faf79c63baa3" class="bulleted-list"><li>分类<ul id="9651e1ba-70ff-4d06-8bf2-60e83f5f5717" class="bulleted-list"><li>客户进程：启动沟通的进程</li></ul><ul id="584c7318-ca04-431b-b6c6-932ca3141725" class="bulleted-list"><li>服务器进程：等待联系的进程</li></ul><ul id="6ab9b6ff-5970-441d-b22c-5a42e2b74617" class="bulleted-list"><li>注意：具有 P2P 架构的应用程序具有客户端进程和服务器进程</li></ul></li></ul></li></ol><ol id="516b6525-d847-4e46-bfa7-47e31ad2094c" class="numbered-list" start="2"><li>套接字：介于传输层和应用层之间，完成两个层次的递交<ul id="2da3db86-51ac-4c76-96be-30dd0cedd56b" class="bulleted-list"><li>进程向/从套接字发送/接收消息</li></ul><ul id="399e36ad-4a7b-4d62-94d4-f5cfdbc12664" class="bulleted-list"><li>进程调用套接字进行通信</li></ul><ul id="3f26e732-13a6-4fa2-a2b6-350ea62aff7e" class="bulleted-list"><li>类似于门的插座<ul id="1163a501-6110-4d8d-9b61-a56078222786" class="bulleted-list"><li>发送过程将消息推到门外</li></ul><ul id="4a6b6ae0-2583-45c0-9f81-e54cd6441058" class="bulleted-list"><li>发送过程依赖于门另一侧的运输基础设施，在接收过程中将消息带到套接字</li></ul></li></ul></li></ol><ol id="71bad75b-04f4-4072-a532-1a77746ffc0f" class="numbered-list" start="3"><li>进程寻址：<p id="b946c5bc-a8ce-4e4e-8ecc-582973edeee0" class="">尽管IP是主机的唯一标识，但是单纯的通过 IP 地址不能进行进程寻址，因为在同一个目的主机上可能运行着多个不同的进程，单靠 IP 地址无法区分因此，通过传输层的 IP 地址+端口号的形式进行组合寻址</p></li></ol><ol id="7f0cfc37-446f-4655-b632-e4295049a2db" class="numbered-list" start="4"><li>应用层协议定义<ul id="c30950eb-05b1-4405-98b9-6aafbba8c496" class="bulleted-list"><li>内容<ul id="19653ef5-16ad-4109-8a49-5bdf658f0609" class="bulleted-list"><li>交换的<strong>消息类型</strong>，<mark class="highlight-red">请求和响应消息</mark></li></ul><ul id="84402fba-6b0c-42c6-bdb3-6cb467c3edb8" class="bulleted-list"><li>消息类型的<strong>语法</strong>：消息中的哪些字段以及如何描绘字段</li></ul><ul id="0e53af5d-e45a-4be9-ae48-d68da6029399" class="bulleted-list"><li>字段的<strong>语义</strong>，即字段中信息的含义</li></ul><ul id="cdde2e08-1c95-4680-8015-12b70b939d62" class="bulleted-list"><li>进程何时以及如何发送和响应消息的<strong>规则</strong></li></ul></li></ul><ul id="b7c20096-b7d9-4694-bb03-82a7293b0043" class="bulleted-list"><li>分类<ul id="1ac708c2-8759-4731-9e23-1d3caa1f5004" class="bulleted-list"><li>公共领域协议：<p id="c0ac7238-0d0e-421f-a5fc-d0255019daa4" class="">在 RFC 中定义的，允许互操作性，例如 HTTP，SMTP；
因为 RFC 是 C/S 架构的，因此公共领域协议基本都是 C/S 架构的</p></li></ul><ul id="001b8152-a954-4baa-b89b-8b4ca2ce7bfb" class="bulleted-list"><li>私有域协议：<p id="ae362e2d-a131-4480-af3f-dfafcadfb9ab" class="">例如，Skype，ppstream</p></li></ul></li></ul></li></ol></details></li></ul><ul id="cf2b99f5-b0aa-4648-9657-19a92cc73cce" class="toggle"><li><details open=""><summary>应用层的需求</summary><ul id="62355ac2-8b87-4cb0-a92a-0935c5371176" class="toggle"><li><details open=""><summary>应用层需要<strong>传输层</strong>提供的服务</summary><ul id="6470e359-3734-4f13-8e2c-d6bcc60b9786" class="bulleted-list"><li>数据完整性<ul id="5571b36d-6b9f-4c54-b287-9d6b636df6b5" class="bulleted-list"><li>某些应用程序（例如文件传输，网络交易）需要 100％可靠的数据传输，因此需要传输层的 TCP 协议</li></ul><ul id="bd1aba93-a2d6-4cad-8b5f-4ebe6a07515c" class="bulleted-list"><li>其他应用（例如音频、视频）可以容忍一些损失，因此需要 UDP 协议</li></ul></li></ul><ul id="9fd1d72e-e291-4c38-9e1f-00a0b783ec3b" class="bulleted-list"><li>实时性<ul id="2ac75a5e-f1e4-497b-9639-ed6faca564d0" class="bulleted-list"><li>某些应用（例如互联网电话，互动游戏）要求低延迟才能生效</li></ul></li></ul><ul id="d478dd25-3edd-4c01-b5c9-b6742a33e0d6" class="bulleted-list"><li>吞吐量<ul id="bcb053ef-6851-49eb-b9ef-4bf10bacbb95" class="bulleted-list"><li>一些应用程序需要有最小链路带宽的保证，才能正常运行</li></ul><ul id="98d8d341-8abc-40fe-a683-3da448cb40b0" class="bulleted-list"><li>另外一些则不需要，多慢的网都可以</li></ul></li></ul><ul id="612cae01-fa63-41b5-9b66-6b8bb7b277eb" class="bulleted-list"><li>安全性<ul id="a93dce8b-bc68-4e62-9b24-226ecee113c2" class="bulleted-list"><li>传输加密，数据完整性</li></ul><figure id="412ce5ed-2a6b-46a6-9483-c2700b6d3c8e" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image44.png"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image44.png"/></a></figure></li></ul></details></li></ul><ul id="81cc8bee-e1b5-4b93-b38a-ce4611cf5c7a" class="toggle"><li><details open=""><summary>TCP 协议可以提供的服务</summary><ul id="895ffc76-5a3a-466d-b483-504ab74a5604" class="bulleted-list"><li>面向连接服务：客户端和服务器进程之间需要建立通信，即通信前的三次握手确认机制</li></ul><ul id="94a220ac-66ca-4e4c-b39b-3bb608a641f7" class="bulleted-list"><li>数据完整性：发送和接收过程之间的可靠传输</li></ul><ul id="a5798a32-07cf-46e3-a6d9-f44567c688a3" class="bulleted-list"><li>流量控制：发送方不会淹没接收方</li></ul><ul id="4dc05608-e587-463b-8989-f5a7c19e0990" class="bulleted-list"><li>拥塞控制：网络过载时对发送方控制</li></ul><ul id="d0e358e1-56a0-4a95-8437-e4e2fe1239fb" class="bulleted-list"><li>不提供：实时性，最小链路带宽（因为和流量、拥塞情况有关，根本做不到）</li></ul></details></li></ul><ul id="4575e04a-70ed-4598-8260-fadff73c938a" class="toggle"><li><details open=""><summary>UDP 协议可以提供的服务</summary><ul id="f704e3c7-cdd4-4d83-bdcb-1a6a94a7a53b" class="bulleted-list"><li>发送和接收过程之间的数据传输不可靠</li></ul><ul id="b94d6545-1254-4d01-a9fa-369c0848f310" class="bulleted-list"><li>不提供——啥都没有<ul id="511fbc6b-0a16-4907-bb28-e6ff198c55f3" class="bulleted-list"><li>连接设置，可靠性，流量控制，拥塞控制，时序或带宽保证</li></ul></li></ul><ul id="abc44864-9b5b-4cd5-a642-535d9bb49381" class="block-color-red bulleted-list"><li><mark class="highlight-red">适用于应对瞬时的大量请求，和大量数据传输；
因为 UDP 协议要求少， 建立通信简单，能够非常快的进行传输</mark><figure id="3402a657-6211-4f2c-92d7-c9513608320d" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image45.png"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image45.png"/></a></figure></li></ul></details></li></ul></details></li></ul><h1 id="25ab57be-3edd-4daa-83ff-2fecad2e80ab" class="">二、WEB和HTTP</h1><h2 id="f766becb-22a2-48e7-a0c9-e363c629e965" class="">术语</h2><p id="858524b8-dffc-433f-9cd9-f4ca75e836ac" class="">网页<div class="indented"><ul id="48ae9766-0154-492b-8649-d4c199c89b21" class="bulleted-list"><li>网页由对象组成</li></ul><ul id="eb54b70a-6824-4edc-9d1d-fecf4d48db96" class="bulleted-list"><li>对象可以是 HTML 文件，JPEG 图像，Java applet，音频文件…</li></ul><ul id="46a7b3f6-6d7d-44aa-84d3-6a4311af6d02" class="bulleted-list"><li>网页由基本 HTML 文件组成，其中包含几个引用的对象</li></ul><ul id="5e238798-b1b9-42cd-8712-7f15a294f589" class="bulleted-list"><li>每个对象均可通过 URL 寻址<figure id="470231af-4a8a-44b9-bf31-92088263841a" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image46.png"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image46.png"/></a></figure></li></ul></div></p><h2 id="0eb014e5-519b-4037-b24b-202882385794" class="">HTTP</h2><ul id="0cc573c4-ad3a-4bd5-83bf-04dab1d7b486" class="toggle"><li><details open=""><summary>HTTP 概述</summary><ul id="e7915063-a0c6-4fbf-88a5-8478e45061b7" class="bulleted-list"><li><strong>HTTP：超文本传输协议</strong><ul id="2b23ed51-6c6b-4df5-bf6e-b8552223e3d7" class="bulleted-list"><li>是 Web 的应用层协议，符合客户/服务器模型</li></ul><ul id="def41070-622c-4496-9413-d1b7610f1d92" class="bulleted-list"><li>客户：请求，接收，“显示” Web 对象的浏览器</li></ul><ul id="af4d73ad-4cd1-44da-9d83-c6c0921901e0" class="bulleted-list"><li>服务器：Web 服务器发送对象以响应请求</li></ul></li></ul><ul id="62e0d0cb-dd87-460f-b37d-9ff6d6100303" class="bulleted-list"><li>使用 TCP <ul id="220c1af2-2331-4b8f-86e1-9020d31743e5" class="bulleted-list"><li>客户端启动与服务器端口 <strong>80</strong> 的 TCP 连接（创建套接字）</li></ul><ul id="4a516580-47e2-4097-a4bc-eccab72a5697" class="bulleted-list"><li>服务器接受客户端的 TCP 连接</li></ul><ul id="50cfede7-907a-4b7d-94a2-22bff10f36fc" class="bulleted-list"><li>HTTP 消息（应用程序层协议消息）在浏览器（HTTP 客户端）和 Web服务器（HTTP 服务器）之间交换</li></ul><ul id="d5ad7417-8e59-4d1c-a6cb-312a2964f6b0" class="bulleted-list"><li>TCP 连接关闭</li></ul></li></ul><ul id="4e40448f-50de-40aa-89bd-05136a3b15d3" class="bulleted-list"><li>HTTP 是“无状态的”<ul id="54001144-ba6c-4966-8fc5-d9815aa2cb45" class="bulleted-list"><li>服务器不维护有关过去客户端请求的信息，可以无限请求(刷新不受限制)</li></ul><ul id="ac0b9ebf-0083-4b82-80bb-17633371c1b0" class="bulleted-list"><li>维持“状态”的协议很复杂<p id="52d5c4e3-adb1-4bfc-8d6c-dec9e5c940df" class="">因为必须服务器保留过去的历史（状态），如果服务器/客户端一方崩溃，则它们的“状态”视图不会不一致，必须协调一致</p></li></ul></li></ul></details></li></ul><ul id="e58a7277-752e-4bdb-948a-5487dd9428dc" class="toggle"><li><details open=""><summary>HTTP 连接</summary><ol id="3f485daa-5354-413f-9ab5-9b35d1e0cb46" class="numbered-list" start="1"><li>非持久链接：<ul id="1a15b0d8-079c-441d-8187-245b13fdad59" class="bulleted-list"><li>非持久 HTTP：<mark class="highlight-blue">串行</mark>的非持久 TCP 链接 22<p id="a0b9e5cf-d5c0-49d3-8f43-3e0ed8af82ec" class="">通过 TCP 连接最多发送一个对象，传输完成后连接关闭，下载多个对象时需要多个连接；
不停的在重复建立连接关闭连接的过程，<strong>即每次只能开一扇门每次只能拿一件东西</strong></p></li></ul><ul id="4abceb34-40c0-4d55-95e1-afa6738f672a" class="bulleted-list"><li>非持久 HTTP：<mark class="highlight-blue">并行</mark>的非持久 TCP 链接 6<p id="4f0b9c57-d454-4b77-919b-b8534caf5622" class="">通过 TCP 连接最多发送一个对象，传输完成后连接关闭，但是可以同时建立<strong>多个</strong>链接，下载多个对象时需要多个连接，这多个链接可以并行；
<strong>即每次能开多个门，经过每个门只能拿一件东西，但是可以从多个门同时取东西</strong></p></li></ul></li></ol><ol id="162ef58a-c5cb-4a59-879e-0cc5df91d557" class="numbered-list" start="2"><li>持久链接：<ul id="3fd58209-c6cd-48d2-80f9-78418b4f71cf" class="bulleted-list"><li>持久 HTTP：<mark class="highlight-blue">不带流水</mark>的工作方式 12<p id="21ded951-38fa-4bfb-9654-79830d72fc15" class="">客户端，服务器之间可以通过单个 TCP 连接发送多个对象，客户仅在收到先前的响应后才发出新请求，每个对象花费一个 RTT。<strong>即敲开门后，取东西的指令一条一条的提出，这个过程中门始终不会关闭</strong></p></li></ul><ul id="a9e109b0-a211-457c-b15e-d2f51da14b65" class="bulleted-list"><li>持久 HTTP：<mark class="highlight-blue">带流水</mark>的工作方式 3<p id="9bb96e5d-11ee-4b48-8f18-b90899f7df5b" class="">客户端，服务器之间可以通过单个 TCP 连接发送多个对象。客户端在遇到引用对象后立即发送请求，所有引用的对象仅需1 RTT。<strong>即敲开门后，取东西的指令写成流水单据，一次性给服务器，服务器全部找到需要的东西后，一股脑的全回复给客户端，这个过程中门始终不会关闭</strong>
<mark class="highlight-red">注意：服务器端为了节省服务器资源，一般在请求结束后会关闭 TCP 连接， 即使客户端要求 keep alive</mark></p></li></ul></li></ol></details></li></ul><ul id="0e63713f-4e7c-41cb-aed7-1bb7637bb752" class="toggle"><li><details open=""><summary>响应时间建模</summary><ul id="a52a0b4b-9772-4f34-9d8a-e203fbe5e4ce" class="bulleted-list"><li><strong>RTT 的定义
</strong>发送小数据包从客户端到服务器再返回的时间。</li></ul><ul id="758dabf3-2c7f-4f7a-b06a-272c360d2c13" class="bulleted-list"><li>响应时间包括：<ul id="07704f64-a9b2-4532-b367-6d010d3a3b3e" class="bulleted-list"><li>一个 RTT 启动 TCP 连接</li></ul><ul id="c9a68bf3-8f8c-4498-96f7-26d267b0879e" class="bulleted-list"><li>一个 RTT 用于 HTTP 请求的 RTT 和 HTTP 的前几个字节回应回报</li></ul><ul id="e4d24acb-6bf7-43f0-a574-bc62ac72e777" class="bulleted-list"><li>文件传输时间</li></ul></li></ul><ul id="ce6e2f26-a9bc-4f0a-ae0f-ecbadda31fb5" class="bulleted-list"><li><strong>示例</strong><p id="3b924627-df52-4410-a418-1221558f822c" class=""><mark class="highlight-blue">假设要请求一个网页，并且该网页附带 10 个引用对象
因为传输时间特别少，所以就忽略了</mark></p><ul id="ff6f30c9-9857-4dfa-9f5e-4c35457c6c1b" class="bulleted-list"><li>若采用串行的非持久 TCP 链接<p id="f556eb2c-a79a-426a-b2ec-1d8ba32c39b2" class="">先需要 2 个 RTT 请求网页信息，随后每次都需要 2 个 RTT 进行附带对象的请求，因此共计需要 22 个 RTT</p></li></ul><ul id="d57be287-5059-4169-83a4-f213658d6494" class="bulleted-list"><li>若采用并行的非持久 TCP 链接<p id="52d5365c-8a0d-4788-95d5-8199176e2c95" class="">假设最大可以有 5 个 TCP 并行，则先需要 2 个 RTT 请求网页信息， 随后每次需要 2 个 RTT 同时发起 5 个 TCP 链接请求到 5 个附带对象，因此共计需要 6 个 RTT</p></li></ul><ul id="216de7ce-b8a6-43ee-b7e7-69305cd0334a" class="bulleted-list"><li>持久 HTTP：不带流水的工作方式<p id="e5d5f7ea-66cb-4381-9648-a96a5dbbc0d1" class="">先需要 2 个 RTT 请求网页信息，<mark class="highlight-red">随后 TCP 链接不关闭</mark>，每次都需要</p><p id="788ef4a1-532b-4c4f-963d-aef30cec946a" class="">1 个 RTT 进行 1 个附带对象的请求，因此共计需要 12 个 RTT</p></li></ul><ul id="c043eccd-8ffb-436c-adce-413451e0470c" class="bulleted-list"><li>持久 HTTP：不带流水的工作方式<p id="22bbdcd5-b542-4502-9074-ee3b9a8b79b8" class="">先需要 2 个 RTT 请求网页信息，随后 TCP 链接不关闭，用 1 个 RTT</p><p id="e3437ef3-8025-412f-bbee-c8e2a042b60c" class="">发送流水单，因此共计需要 3 个 RTT。<mark class="highlight-red">流水单相当于记录了所有的需要发的”货“。</mark></p></li></ul></li></ul></details></li></ul><ul id="38cd6bd5-0cb3-4ad6-8cfb-2ae0f70af33a" class="toggle"><li><details open=""><summary>万维网的工作过程</summary><ul id="84c70fec-c51a-4085-adca-1b3019e8ab57" class="bulleted-list"><li>用户点击鼠标后所发生的事件<ol id="38e4dd29-ecf6-4315-9154-62e107264c3b" class="numbered-list" start="1"><li>浏览器分析超链接指向页面的 URL。</li></ol><ol id="c2553735-abee-423e-a61d-a348e966ea35" class="numbered-list" start="2"><li>浏览器向 DNS 请求解析 <a href="http://www.tsinghua.edu.cn/">www.tsinghua.edu.cn</a> 的 IP 地址。</li></ol><ol id="9ebc8995-c97b-4fcd-9d9e-bd77d1957d9b" class="numbered-list" start="3"><li>域名系统 DNS 解析出清华大学服务器的 IP 地址。</li></ol><ol id="d89bca97-00c4-45fb-ae8b-d4004a5e07af" class="numbered-list" start="4"><li>浏览器与服务器建立 TCP 连接<figure id="46739670-1773-449a-ad41-b40e8682dfab" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image47.png"><img style="width:480px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image47.png"/></a></figure></li></ol><ol id="e02ab1f5-a3f5-46d8-82b9-54bb0236d65d" class="numbered-list" start="5"><li>浏览器发出取文件命令：GET /chn/yxsz/index.htm。</li></ol><ol id="28e17de5-617f-495e-8c6d-9ee1411f5fb0" class="numbered-list" start="6"><li>服务器给出响应，把文件 index.htm 发给浏览器。</li></ol><ol id="542ced8c-59db-48b0-81de-ded5c537ba1b" class="numbered-list" start="7"><li>TCP 连接释放。</li></ol><ol id="9677dd9d-b505-40fb-8878-6ac1de194c85" class="numbered-list" start="8"><li>浏览器显示“ 清华大学院系设置” 文件index.htm 中的所有文本</li></ol></li></ul></details></li></ul><ul id="55d46df1-cd82-492c-8e48-d7679b956d71" class="toggle"><li><details open=""><summary>HTTP 请求信息</summary><p id="c6764c7d-fcce-4904-b0d8-1130079a4309" class="">两种 HTTP 消息：请求，响应</p><figure id="7b10da6d-5147-4f50-9ee6-6491f0b8482a" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image48.png"><img style="width:384px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image48.png"/></a></figure><figure id="a997cb3a-b259-4879-9ee8-ffb8213b4c56" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image51.png"><img style="width:384px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image51.png"/></a></figure><figure id="dfc0db35-4489-4e51-b90b-8eb30745a7b8" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image52.png"><img style="width:384px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image52.png"/></a></figure></details></li></ul><ul id="32d59407-8909-4c86-afe7-61fc1fa6029a" class="toggle"><li><details open=""><summary>HTTP 响应信息</summary><figure id="4d99ab9e-6190-4661-a5bc-fe07b9ab6160" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image53.png"><img style="width:528px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image53.png"/></a></figure><ul id="9c3aee5d-da02-4473-bab4-9d0f8014921f" class="bulleted-list"><li><strong>首部行：</strong>协议、状态码等<figure id="c9b5cfa1-f506-4a54-a1cf-ff41a44bfe84" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image54.png"><img style="width:432px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image54.png"/></a></figure></li></ul><ul id="9d065e37-86b8-49ec-8a30-99a7c28fb9ff" class="bulleted-list"><li><strong>HTTP 响应头：</strong><p id="c04308ac-7eeb-4bb8-8966-a3074961ab3d" class="">Date：服务器时间，响应这个请求的时间
Server：服务器信息
Last-Modified：要请求的文件的最后一次修改日期
Connection：连接方式，上图为保持连接， 其中 Keep-Alive 指明了超时时间
Content-Type：指明可以接收的数据类型
<mark class="highlight-red">注意：header 和 data 之间一定有空行</mark></p><figure id="bdda219d-1972-4981-a9b1-96a60668e1cd" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image55.png"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image55.png"/></a></figure></li></ul></details></li></ul><h3 id="0536d4b3-e1e1-427f-8d9a-d772bbaa6669" class="">基于 HTTP 协议的工作机制 1---cookie(了解)</h3><ol id="0df0ca3f-b6a3-400f-97f9-0a08b57942e4" class="numbered-list" start="1"><li>引出<p id="233f2e73-1e28-4e9b-991d-28d4814bbff4" class="">HTTP 服务器是无状态的，这简化了服务器的设计，并且允许工程师们去开发可以同时处理数以千计的 TCP 连接的高性能 Web 服务器。然而一个 Web 站点通常希望能够识别用户，可能是因为服务器希望限制用户的访问，或者因为它希望把内容与用户身份联系起来。</p></li></ol><ol id="4fc1e3e9-f281-453d-b8f5-fbb1c0df6860" class="numbered-list" start="2"><li>Cookie 的组成<ul id="8b8252a8-c223-42ec-a771-75bd488e0ddc" class="bulleted-list"><li>在 HTTP 响应报文中的一个 cookie 首部行；</li></ul><ul id="84fef14a-71cd-4b3f-ae36-3a0f55cab2bd" class="bulleted-list"><li>在 HTTP 请求报文中的一个 cookie 首部行；</li></ul><ul id="4b33e8bf-d3f6-4330-8605-b4b831326f17" class="bulleted-list"><li>在用户端系统中保留有一个 cookie 文件，并由用户的浏览器进行管理；</li></ul><ul id="9979192c-b85b-4860-a246-1110031f11b8" class="bulleted-list"><li>位于 Web 站点的一个后端数据库；</li></ul></li></ol><ol id="5e7bba70-d779-4345-9ac8-f0bd46414020" class="numbered-list" start="3"><li>示例<p id="fb83e15e-bc4b-4408-9411-47a05d0855c8" class="">Susan 总是从同一台 PC 访问 Internet，当她是首次访问特定的电子商务网站的时候，初始 HTTP 请求到达站点时，站点将创建一个唯一的 ID 并且在响应报文中的头部的“Set-Cookie”字段返回给浏览器，并在后端数据库中为该 ID 创建一个条目。当 Susan 再次访问该网站时，所有的请求都带上这个 Cookie，服务器就可以从数据库中提取出该用户的相关信息，从而免除用户的个人信息再次填写。</p><figure id="1be5d3a9-91e9-4e63-b46d-1331671a22b5" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image56.jpeg"><img style="width:432px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image56.jpeg"/></a></figure></li></ol><ol id="f8d01f9b-a77f-4589-8e64-b0bb1cf0bb2d" class="numbered-list" start="4"><li>Cookie 作用<ul id="c411d50a-0dc3-4095-91aa-03dc1bebfe0c" class="bulleted-list"><li>授权：记录用户曾经的授权记录</li></ul><ul id="f6f921e3-9e5b-4bb8-b458-57200b4d5e1c" class="bulleted-list"><li>购物车</li></ul><ul id="338390c1-002a-471a-9257-cfd196c6648d" class="bulleted-list"><li>推荐：根据用户的浏览，进行偏好推荐</li></ul><ul id="d78aba45-1baf-4ffa-a412-304ce77ce615" class="bulleted-list"><li>用户会话状态（Web 电子邮件）</li></ul></li></ol><ol id="4168cdb1-125a-4444-afb7-984f04fdc2a3" class="numbered-list" start="5"><li>如何保持状态？<ul id="a89efdb5-b332-4d29-b7b7-6b853e2545f7" class="bulleted-list"><li>协议中断点：通过多个事务在发送方/接收方保持状态</li></ul><ul id="96c7816d-90bb-4585-b007-75831d5c7f67" class="bulleted-list"><li>Cookies：http 消息携带状态</li></ul></li></ol><ol id="1fb48735-a4c1-4c26-8b43-0fef48e7ba5d" class="numbered-list" start="6"><li>Cookies 和隐私：<ul id="fda9c0b0-d8ad-4714-b700-70f70d573c6f" class="bulleted-list"><li>Cookie 可以使网站对您有很多了解，网站基于 cookie 进行用户行为分析</li></ul><ul id="02444b81-e72e-4702-8b22-9c2fc21ed858" class="bulleted-list"><li>您可以提供姓名和电子邮件到网站，导致个人隐私泄露</li></ul><ul id="a92c340d-fccb-4e23-bf12-054a757faa23" class="bulleted-list"><li>搜索引擎使用重定向和 Cookie 来了解更多信息</li></ul><ul id="ceb7e7cb-bf3a-4287-8fcb-1af22b684757" class="bulleted-list"><li>广告公司跨站点获取信息</li></ul></li></ol><p id="fd8b921f-e423-4755-8e8c-e065fca8771e" class="">
</p><h2 id="daaad9d8-c66b-42d3-bc1d-48b8e8ab9abe" class="">基于 HTTP 协议的工作机制 2---Web caches (了解)</h2><ol id="638b4383-cd3d-4abd-9a86-1aa771a1f904" class="numbered-list" start="1"><li>目标<p id="0011d317-e2e9-4caa-b6d4-af6bc00bdc47" class="">在不涉及原始服务器的情况下满足客户请求。通过在用户和原始服务器之间设置代理服务器的方式，降低原始服务器的访问压力，同时能够使用户更加快捷的访问到服务器的内容。</p></li></ol><ol id="9ec31a2e-89e7-47e2-9f0b-68a68b877330" class="numbered-list" start="2"><li>工作流程<figure id="d302cf66-4cf7-4074-8075-2dce8562dc85" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image57.png"><img style="width:384px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image57.png"/></a></figure><ul id="33018088-77ba-4d48-9e5d-0a18ec6733bb" class="bulleted-list"><li>用户设置浏览器，即使用通过缓存访问 Web 的方式访问</li></ul><ul id="2e6e4315-2b55-48a9-b739-3a673f6e28fd" class="bulleted-list"><li>浏览器将所有 HTTP 请求发送到缓存(代理服务器)<ul id="e1f99211-4bb6-4039-a376-fc91178aeeb7" class="bulleted-list"><li>Web 缓存器进行检查，看看本地是否存储了该对象副本。如果有，Web 缓存器就向客 户浏览器用</li></ul></li></ul></li></ol><ol id="47a5266a-04c9-488b-b130-a4c2a689d607" class="numbered-list" start="3"><li>HTTP 响应报文返回该对象<ul id="ed098a10-5d7e-459d-9d6a-c392305bddd8" class="bulleted-list"><li>否则缓存从原始服务器请<p id="ba11a3b6-d19c-4c29-90d9-afc221e38e68" class="">求对象。当代理服务器接收到该对象时，它在本地存储空间存储一份副本，并向客户的浏览器用 HTTP 响应报文发送该副本（通过已有的客户浏览器和 Web 缓存器之间的 TCP 连接）。</p></li></ul><ul id="f9391c66-91e9-400b-b620-52dbdc9b62e3" class="bulleted-list"><li>代理服务器特点<ul id="6ebe1bcc-17cb-4508-8679-4483574bf651" class="bulleted-list"><li>缓存<mark class="highlight-red">既充当客户端又充当服务器</mark>，当用户请求对象存在于代理服务器， 此时代理服务器是一个服务器，当请求的对象不存在于代理服务器时， 代理服务器充当客户端，去请求原始服务器</li></ul><ul id="7032f412-a56e-436d-9368-ad1480945c8a" class="bulleted-list"><li>通常，缓存是由 ISP（大学，公司，住宅 ISP）维护的</li></ul></li></ul></li></ol><ol id="1bcc0ff1-0f23-4b58-82fa-f949d8fdffc1" class="numbered-list" start="4"><li>代理服务机制的优点<ul id="5c59c986-1ce9-46ec-a48f-1623d5866472" class="bulleted-list"><li>减少客户请求的响应时间</li></ul><ul id="72963f97-6732-4d43-9a3e-20168633af44" class="bulleted-list"><li>Web 缓存器能够大大减少一个机构的接入链路到因特网的通信量。通过减少通信量，该机构（如一家公司或者一所大学）就不必急于增加通信链路带宽，因此降低了费用</li></ul><ul id="f72868b7-70d0-483a-bf7f-666c858947d1" class="bulleted-list"><li>Web 缓存器能从整体上大大减低因特网上的 Web 流量，从而改善了所有应用的性能</li></ul><ul id="084bd8d0-8f02-4aaf-9d54-c72157817bbf" class="bulleted-list"><li>使“贫困”的内容提供者可以有效地传递内容，即使性能一般的原始服务器能够应对较高的访问量</li></ul></li></ol><ol id="6b7b2985-9b72-402f-beeb-147c512960d5" class="numbered-list" start="5"><li>网络代理的示例<figure id="cfd0329a-a211-4da7-9cbd-596cb5f53ee7" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image58.jpeg"><img style="width:192px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image58.jpeg"/></a></figure></li></ol><ol id="bceee1cf-2a46-4c5a-968a-8be1000a9618" class="numbered-list" start="6"><li>假设：<p id="91efbf54-45fd-4a81-9737-1c6a8759a926" class="">假设有两个网络，即机构（内部）网络和公共因特网的一部分。机构网络是一个高速的局域网，其客户机和局域网路由器之间的线路带宽为 100Mbps，局域网路由器与因特网上的一台路由器通过一条 15Mbps 的链路连接。初始服务器与因特网相连但位于全世界各地。假设所请求的对象的平均长度为 1Mb，从机构内的浏览器对这些初始服务器的平均访问速率为每秒 15 个请求，<mark class="highlight-red">从机构路由器发出 http 请求到收到响应的 RTT 为2 秒（因特网时延为2s）。</mark></p><ul id="3be6133a-7369-4d6f-a01f-d749c4bf6a33" class="toggle"><li><details open=""><summary>方案 1—原始情况</summary><p id="956a2afb-632e-4f0b-bf22-eb6ad6b66e79" class="">总的响应时间，即从浏览器请求一个对象到接收到该对象为止的时间，是局域网时延、接入时延（即两台路由器之间的时延）和因特网时延(2S)之和。</p><p id="0b2bc954-1336-437d-a519-81b24424f60e" class="">局域网流量强度：(15 个请求/s）×（1Mb/请求）/（100Mbps）=0.15</p><p id="6a433147-5505-46a1-9562-cbf33781e07c" class="">接入链路流量强度，<strong>从局域网路由器到因特网路由器：</strong>
（15 个请求/s）×（1Mb/请求）/（15Mbps）=1
<mark class="highlight-red">局域网上强度为 0.15 的通信量最多导致数十毫秒的时延，因此我们可以忽略局域网时延。接入链路的流量强度为 1，这将导致链路上的时延会变得非常大并且无限增长。</mark>因此，满足请求的平均响应时间将在分钟的量级上。显然，必须想办法来改进时间响应特性。</p><figure id="9d61b88f-a5d3-4d15-8fef-a5e1efb341c4" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image59.jpeg"><img style="width:192px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image59.jpeg"/></a></figure></details></li></ul><ul id="5a910733-ec82-40fd-be45-a79815e9b024" class="toggle"><li><details open=""><summary>方案 2—增加接入链路带宽</summary><p id="2a30768d-c98e-4b30-ab24-8684a0dd3c3b" class="">可以采用更换局域路由器和公用网路由器之间的物理线路，采用更高带宽的设备，但是这种方法的花费极高</p></details></li></ul><ul id="2c7f0dcd-5a85-488f-ad0f-fbbb435f8470" class="toggle"><li><details open=""><summary>方案 3—使用本地缓存</summary><p id="9d56dc03-1663-466e-9bf7-19058892d59a" class="">不升级链路带宽而是在机构网络中安装一个Web 缓存器</p><ul id="45b8592d-d6cf-49c9-85af-42e0acb422b2" class="bulleted-list"><li>假设：<p id="97c67f7e-4485-497f-9e3b-7a004ab95754" class="">缓存命中率为 0.4，即局域网中的 web 缓存满足 40％的请求，原始服务器满足 60％的请求</p></li></ul><ul id="ac2f76ba-1d0f-434f-b92c-007f8ec32c9a" class="bulleted-list"><li>计算：<p id="931df90e-d081-4317-b44e-d7318bda292a" class="">因为客户和缓存连接在一个相同的高速局域网上，这样 40%的请求将几乎立即会由缓存器得到响应，时延约在 10ms 以内。</p><p id="c5b08685-75d1-442c-a914-519a824f5380" class="">只有 60%的被请求对象通过接入链路，因此接入链路上的流量强度从 1.0 减小到 0.6。一般而言，在 15Mbps 链路上，当流量强度小于 0.8 时对应的时延较小，约为几十毫秒。这个时延与 2 秒因特网时延相比是微不足道的。</p><p id="19a9822e-dbad-40d9-86d3-b9b1435da45f" class="">因此，平均时延为：0.4×（0.010 秒）+0.6×（2.01 秒）</p></li></ul><ul id="1cc353bb-3636-4570-885c-65778b6454f6" class="bulleted-list"><li>分析：<p id="00db0762-1cec-4c59-bfd4-16b9a3d663fd" class="">方案 3 提供的响应时延甚至比方案 1 更低，也不需要该机构升级它到因特网的链路，因此成本较低</p></li></ul></details></li></ul></li></ol><h2 id="c932491d-fdfe-42c4-85c7-88d17b07f106" class="">基于 HTTP 协议的工作机制 3---条件GET 方法 (了解)</h2><ol id="91e25896-ebc0-481e-a219-64f30cdcd5a3" class="numbered-list" start="1"><li>引入/定义<p id="1d230393-0079-41b7-9fa2-1f30ce8b951a" class="">放在<strong>缓存器中的对象副本可能是陈旧的</strong>。换句话说，保存在服务器中的对象自该副本缓存在客户上以后可能已经被修改了。HTTP 协议有一种机制，允许缓存器证实它的对象是最新的。这种机制就是条件 GET（conditional GET）方法。</p></li></ol><ol id="50f91e2a-35dc-4b5f-a1d5-d17e459290b9" class="numbered-list" start="2"><li>应用 
如果：<ul id="005e02e8-f75a-48dd-b9f9-b9d5e02d9213" class="bulleted-list"><li>请求报文使用 GET 方法</li></ul><ul id="f1389cb7-d307-4d78-9927-485fd992fae1" class="bulleted-list"><li>请求报文中包含一个<strong>“If-Modified-Since:&lt;date&gt;”</strong>首部行</li></ul><p id="fe5b33b8-2355-4724-8994-ce0c3121075d" class="">那么，这个 HTTP 请求报文就是一个条件 GET 请求报文。</p></li></ol><ol id="68f357d6-9bfe-4903-9a5a-1a74cbaf7b2d" class="numbered-list" start="3"><li>示例<ol id="3ad563bd-3155-42b8-9d4f-8791d2378213" class="numbered-list" start="1"><li>一个代理缓存器（proxy cache）代表一个请求浏览器，向某 Web 服务器发送一个请求报文：<figure id="0d06ebe8-cec0-40cb-99c3-629b7cdc3de1" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image60.jpeg"><img style="width:288px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image60.jpeg"/></a></figure></li></ol><ol id="4cde4e9c-31e8-4732-a80c-4e4219483178" class="numbered-list" start="2"><li>该 Web 服务器向缓存器发送具有被请求的对象的响应报文：<figure id="a4c8d333-2b69-4807-ae4d-0dc1440105bf" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image61.jpeg"><img style="width:389px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image61.jpeg"/></a></figure><p id="acabfb22-39f2-4111-a774-817dd1a1c96b" class="">该代理缓存器在将对象转发到请求的浏览器的同时，也在本地缓存了该对象。重要的是，缓存器在存储该对象时也存储了最后修改日期。</p></li></ol><ol id="1ef5067d-cf59-4610-af48-889a7962d127" class="numbered-list" start="3"><li>一段时间后，另一个用户经过该缓存器请求同一个对象，该对象仍在这个缓存器中。由于在过去的一个星期中位于 Web 服务器上的该对象可能已经被修改了，该缓存器通过发送一个条件 GET 执行最新检查：<figure id="e6f577dc-1402-4c72-a22b-066547137ea3" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image62.jpeg"><img style="width:424px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image62.jpeg"/></a></figure><p id="d8225ac9-5420-410c-9bf7-ec545e290f8e" class=""><mark class="highlight-red">If-Modified-Since：首部行的值正好等于一星期前服务器发送的响应报文中的 Last-Modified：首部行的值。</mark>该条件 GET 报文告诉服务器，仅当自指定日期之后该对象被修改过，才发送该对象。</p></li></ol><ol id="e3548f9c-ea38-44a6-8c16-09d424f83297" class="numbered-list" start="4"><li>假设该对象自 2011 年 9 月 7 日 09：23：24 后没有被修改。接下来的第四步，Web 服务器向该缓存器发送一个响应报文：<figure id="84fb808b-8830-48b2-9677-3b1e73dd2853" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image63.jpeg"><img style="width:331px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image63.jpeg"/></a></figure><p id="9bce071a-98bf-4b90-ba8f-0fe0d10473d1" class="">该响应报文中没有包含所请求的对象，包含该对象只会浪费带宽，并增加用户感受到的响应时间。并且，最后的响应报文中，状态行中为 304 Not Modified，它告诉缓存器可以使用该对象，能向请求的浏览器转发它（该代理缓存器）缓存的该对象副本。</p></li></ol><ol id="5e177916-9ddd-4787-bcc2-8ca9ceda25f2" class="numbered-list" start="5"><li>假设该对象自 2011 年 9 月 7 日 09：23：24 后有修改，原始服务器就采用正常的 GET 响应方式，返回代理缓存器请求的对象</li></ol></li></ol><p id="27d56b8d-6f1e-41f1-9e5f-e31ee23fb026" class="">
</p><h1 id="aaf9fe1e-a8fe-43e2-90d8-a012befce6c1" class="">三、FTP（了解）</h1><ul id="98c29211-4177-4789-add3-ce2130fc9370" class="toggle"><li><details open=""><summary>工作过程</summary><ul id="d7ccec2f-c21f-4fb9-8164-be80f6210697" class="bulleted-list"><li>用户通过一个 FTP 用户代理与 FTP 交互。该用户首先提供远程主机的主机名，使本地主机的 FTP 客户进程建立一个到远程主机 FTP 服务器进程的 TCP 连接。</li></ul><ul id="2da39b0f-246d-4067-b5b5-d53d3fb14e8b" class="bulleted-list"><li>该用户接着提供用户标识和口令，作为 FTP 命令的一部分在该 TCP 连接上传送。<figure id="b2c89d74-7341-453a-acfe-e8f408c63e8f" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image64.jpeg"><img style="width:680px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image64.jpeg"/></a></figure></li></ul><ul id="82d0f4ba-4faa-445f-a8d7-f17c96f184cf" class="bulleted-list"><li>一旦该服务器向该用户授权，用户可以将存放在本地文件系统中的一个或者多个文件复制到远程文件系统（反之亦然）。</li></ul></details></li></ul><ul id="8826af9c-bd02-47ed-bfa9-3f30ba439107" class="toggle"><li><details open=""><summary>特点</summary><ul id="9f72179c-eb44-4028-bcb4-8f22c795dbd0" class="bulleted-list"><li>HTTP 和 FTP 都是文件传输协议，并且有很多共同的特点，例如，它们都运行在 TCP 上，是一种面向连接的稳定传输服务</li></ul><ul id="f0594ed7-bcb2-460a-a113-950aa19e7bdd" class="bulleted-list"><li>FTP 使用了两个并行的 TCP 连接来传输文件：一个是<strong>控制连接</strong>（control connection），一个是<strong>数据连接</strong>（data connection）。</li></ul><ul id="829fd2ef-834f-41d5-a1e2-6fe8194c6f0d" class="bulleted-list"><li>控制连接用于在两主机之间传输控制信息，如用户标识、口令、改变远程目录的命令以及“存放（put）”和“获取（get）”文件的命令，<strong>通过 21 端口建立连接</strong></li></ul><ul id="097147ff-bda5-41b9-8f33-9b145ecebdf5" class="bulleted-list"><li>数据连接用于实际发送一个文件，<strong>通过 20 端口建立连接</strong></li></ul><ul id="b5347f0d-f0c4-4a5d-8e18-09e95fcb8e2b" class="bulleted-list"><li>FTP 服务器必须在整个会话期间保留用户的状态（state）,<strong>是状态维持的</strong><ul id="14d04421-4a52-47c2-96a2-77b27df1c914" class="bulleted-list"><li>特别是，服务器必须把特定的用户账户与控制连接联系起来，随着用户在远程目录树上徘徊，服务器必须追踪用户在远程目录树上的当前位置。<figure id="3ef51abf-f0e0-42e4-bf69-e2e0474fd604" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image65.jpeg"><img style="width:391px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image65.jpeg"/></a></figure></li></ul></li></ul></details></li></ul><h1 id="f51f58fc-a65a-4bdc-a39e-bef7e7a31bb7" class="">四、电子邮件—SMTP/POP3/IMAP 协议</h1><ul id="606dc84d-0c46-48cf-995c-2d9e457b766d" class="toggle"><li><details open=""><summary>组成</summary><ul id="aabf9904-7175-4a51-a6fd-32c5de61695c" class="toggle"><li><details open=""><summary>用户代理 user agent</summary><p id="d0351d71-268c-4f2b-9028-63e0f7bf73e3" class="">用户代理允许用户阅读、回复、转发、保存和撰写报文，专用的电子邮件软件，类似于邮件阅读器。微软的 Outlook 和 Apple Mail 是电子邮件用户代理的例子。</p></details></li></ul><ul id="6be8a98b-50dc-4b24-9198-4f4435fe8ded" class="toggle"><li><details open=""><summary>邮件服务器 mail sever</summary><p id="05c38a2e-19c9-4453-a5d1-940c6f5765e3" class="">每个邮件服务器上有邮箱(mailbox)和报文队列(message queue)：</p><ul id="5a6ecd77-b468-4349-8426-94a5acb24ceb" class="bulleted-list"><li><strong>邮箱中保持着一些用户接收到的电子邮件</strong>，当邮件服务器接收到邮件时，分发到相应的用户信箱。当用户要到他邮箱中读取他接收到的报文时，需要包含他邮箱的邮件服务器鉴别用户身份后，允许用户访问；</li></ul><ul id="d270b651-dd61-4c4b-a700-781827fc7495" class="bulleted-list"><li><strong>报文队列中保持着该邮件服务器上维护的用户发出的邮件。</strong>邮件发出后，先在队列中保持，然后按顺序发出，若发送失败会在报文队列中保持一段时间，通常每 30 分钟左右进行一次尝试；如果几天后仍不能成功，服务器就删除该报文并以电子邮件的形式通知发送方</li></ul></details></li></ul><ul id="27ef15f1-78c4-4ead-92c1-d82067408f6d" class="toggle"><li><details open=""><summary>简单邮件传输协议 SMTP</summary><p id="dc808b06-eb4a-44e2-a38a-9dc66c01b37e" class="">SMTP 是因特网电子邮件中主要的应用层协议。它使用 TCP 可靠数据传输服务，从发送方的邮件服务器向接收方的邮件服务器发送邮件。SMTP 也有两个部分：<strong>运行在发送方邮件服务器的客户端</strong>和<strong>运行在接收方邮件服务器的服务器端</strong>。每台邮件服务器上既运行SMTP 的客户端也运行SMTP 的服务器端。<div class="indented"><figure id="16917c73-a9ac-4714-b3a8-4340c7c17008" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image68.jpeg"><img style="width:240px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image68.jpeg"/></a></figure></div></p><ul id="14a91020-00f5-4084-afab-9df2db55bf34" class="bulleted-list"><li>当一个邮件服务器向其他邮件服务器发送邮件时，它就表现为 SMTP 的客户；</li></ul><ul id="1f645a8c-294a-42b1-bdc5-70f7cf209b1a" class="bulleted-list"><li>当邮件服务器从其他邮件服务器上接收邮件时，它就表现为一个 SMTP 的服务器。</li></ul></details></li></ul></details></li></ul><ul id="5c3d47aa-10f5-4a3c-83ec-604b38f1e300" class="toggle"><li><details open=""><summary>SMTP</summary><ul id="0e985d2f-b79f-49ea-a92e-cbd3ec08ed69" class="toggle"><li><details open=""><summary>关于 SMTP 的说明</summary><ul id="4457f502-6f7e-4a78-8c40-2e5c9db305d0" class="bulleted-list"><li>若用户的发邮件方式是用 web 浏览器登录邮箱，采用的是 HTTP 协议登录自己的发送方邮件服务器，但是发送方和接收方之间的协议，还是 SMTP 协议；专有服务器仍然是SMTP。</li></ul><ul id="b18ac672-e186-4f7f-82f2-d52ee1f3be2d" class="bulleted-list"><li>SMTP 一般不使用中间邮件服务器发送邮件，即使两个通信双方的邮件服务器在地理上相聚很远，其之间的 TCP 连接也是直接相连的；</li></ul><ul id="eb29b4a4-d513-4977-894e-17d634ae9699" class="bulleted-list"><li>特别是，如果接收方的邮件服务器没有开机，该报文会保留在发送方的邮件服务器上并等待进行新的尝试，这意味着邮件并不在中间的某个邮件服务器存留；</li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="08914ed5-28ad-4070-9c98-5ce7c3ae5cd0"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">- 发送成功的消息是发送方邮件服务器给出的，发送失败是接收方邮件服务器给出的
- 发送失败的原因：
    - 发送方和接收方邮件服务器之间建立 SMTP 连接之前的 TCP 三次握手建立失败
    - web 邮件服务器的失败后的尝试连接次数也就 1 、2 次，而专有邮件服务器会每隔一段时间进行多次尝试，相较于更加稳定
    - 目的接收方的接收信箱查找失败</div></figure></details></li></ul><ul id="fac03159-5389-4e04-8227-b6f4ffb66c43" class="toggle"><li><details open=""><summary>发送流程</summary><figure id="17ac0389-1d62-4a1c-885e-23bb24400525" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image69.jpeg"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image69.jpeg"/></a></figure><ul id="2ad0c20e-36aa-4a71-9233-a3082c12f6e1" class="bulleted-list"><li>首先，客户 SMTP（运行在发送邮件服务器上）在 <strong>25</strong> 号端口建立一个到服务器 SMTP（运行在接收邮件服务器上）的 TCP 连接；</li></ul><ul id="23e6f0a9-7af6-41ed-b561-67df314c6e6d" class="bulleted-list"><li>如果服务器没有开机，客户会在稍后继续尝试连接。一旦连接建立，服务器和客户执行某些应用层的握手，就像人们在互相交流前先进行自我介绍一样；</li></ul><ul id="0bbb8a3b-840c-4de9-abaa-c053010de714" class="bulleted-list"><li>在 SMTP 握手的阶段，SMTP 客户指示发送方的邮件地址（产生报文的那个人）和接收方的邮件地址。一旦该 SMTP 客户和服务器彼此介绍之后， 客户发送该报文；</li></ul><ul id="5288cdb0-2811-47f5-ba1a-ff8e0672c62f" class="bulleted-list"><li>SMTP 能依赖 TCP 提供的可靠数据传输无差错地将邮件投递到接收服务器。该客户如果有另外的报文要发送到该服务器，就在该相同的 TCP 连接上重复这种处理；否则，它指示 TCP 关闭连接；</li></ul></details></li></ul><ul id="51357af5-5eee-46ac-be26-5e250d46369f" class="toggle"><li><details open=""><summary>采用客户-服务器体系结构的必要性</summary><ul id="2a858030-6cb9-41da-bf8c-dbb39fb82eb4" class="bulleted-list"><li>假设不使用发送方邮件服务器，发送方用户本地 PC 直接和接收方邮件服务器直连通信：如果不通过发送方邮件服务器进行中继，<strong>发送方的用户代理将没有任何办法到达一个一次不可达的目的地接收服务器</strong>。<mark class="highlight-red">因为发送方邮件服务器可以将一次无法送达的报文存放在自己的报文队列中，发送方邮件服务器可以重复地尝试向接收方邮件服务器发送该报文， 如每 30 分钟一次，直到发送方邮件服务器变得运行为止。</mark></li></ul><ul id="92592651-e38a-4ac4-b478-ea3b8d64314b" class="bulleted-list"><li>假设不使用接收方邮件服务器，发送方邮件服务器直接和用户的本地 PC进行直连通信：为了能够及时接收可能在任何时候到达的新邮件，<strong>接收方的 PC 必须总是不间断地运行着并一直保持在线</strong>。这对于大多数因特网用户而言是不现实的。</li></ul><ul id="ff1798c9-8547-467b-bedb-6d06ca0850c8" class="bulleted-list"><li>假设都不用，每一方都必须同时在线。</li></ul></details></li></ul><ul id="6297a11b-0416-48c3-8498-1bb8dae0e198" class="toggle"><li><details open=""><summary>发送方和接收方交互消息的过程</summary><figure id="028d2c06-305c-4f54-8835-4d3bf8552929" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image70.png"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image70.png"/></a></figure><p id="a1caf429-d847-4a50-947f-f7023feac46c" class="">在上例中，客户从邮件服务器 crepes.fr 向邮件服务器 hamburger.edu 发送了一个报文（“Do you like ketchup？How about pickles？”）。</p><p id="4469cf7d-bac9-4dd9-a674-f751f6cb9a24" class="">作为对话的一部分，该客户发送了 5 条命令：HELO（是 HELLO 的缩写）、MAILFROM、RCPTTO、DATA 以及 QUIT。这些命令都是自解释的。该客户通过发送一个只包含一个句点的行，向服务器指示该报文结束了。（按照 ASCII 码的表示方法，每个报文以“回车”+“换行”+“.”+“回车”+“换行”表示结束）</p><p id="3b5c9115-240a-43ef-b4cf-abc78627a614" class="">服务器对每条命令做出回答，其中每个回答含有一个回答码和一些（可选的） 英文解释。我们在这里指出 SMTP 用的是持续连接：</p><p id="11a607df-c778-45a7-ad49-ce02341546c9" class="">如果发送邮件服务器有几个报文发往同一个接收邮件服务器，它可以通过同一个 TCP 连接发送这些所有的报文。对每个报文，该客户用一个新的 MAILFROM:crepes.fr 开始，用一个独立的句点指示该邮件的结束，并且仅当所有邮件发送完后才发送 QUIT。</p></details></li></ul><ul id="4b22cab7-e76b-4e6e-9f51-0b5ffebf8272" class="toggle"><li><details open=""><summary>SMTP 与 HTTP 的比较</summary><ol id="811b78e4-d9f6-4b8f-911c-afcae69d805a" class="numbered-list" start="1"><li>都用于从一台主机向另一台主机传送文件<ul id="3da1b2a3-1cf8-46af-8841-144db157d7f8" class="bulleted-list"><li>HTTP 从 Web 服务器向 Web 客户（通常是一个浏览器）传送文件（也称为对象）；</li></ul><ul id="2ffdce18-74e3-4981-8bb4-b0377b1ce3f9" class="bulleted-list"><li>SMTP 从一个邮件服务器向另一个邮件服务器传送文件（即电子邮件报文）</li></ul><ul id="7408fa84-11ca-42d5-8d4a-5c0d2e003f36" class="bulleted-list"><li>当进行文件传送时，<strong>持续的 HTTP 和 SMTP 都使用持续连接</strong>；</li></ul></li></ol><ol id="e880647e-470b-474e-8255-d849fa6ff49b" class="numbered-list" start="2"><li>协议的逻辑运行方式有差异：<ul id="6490d426-7d9b-4208-9c01-aa936009202c" class="bulleted-list"><li><strong>HTTP 主要是一个拉协议（pull protocol）</strong>，即在用户需要的时候，使用 HTTP 从服务器拉取这些信息，特别是 TCP 连接是由想接收文件的机器发起的；<strong>SMTP 基本上是一个推协议（push protocol）</strong>，即发送邮件服务器把文件推向接收邮件服务器。特别是，这个 TCP 连接是由要发送该文件的机器发起的；</li></ul><ul id="a600cf2d-7109-4f1c-990c-56224477dfba" class="bulleted-list"><li>SMTP 要求每个报文（包括它们的体）使用 7 比特 ASCII 码格式，HTTP 数据则不受这种限制；</li></ul><ul id="2a1986d5-7382-44dd-816b-255955bc4029" class="bulleted-list"><li>第三个重要区别是如何处理一个既包含文本又包含图形（也可能是其他媒体类型）的文档：<ul id="ac4eee30-f215-486c-8114-fae9d5d3c4f2" class="bulleted-list"><li>HTTP 把每个对象封装到它自己的 HTTP 响应报文中；</li></ul><ul id="e3395fe0-3bd0-4873-a2a6-92798f8c02ab" class="bulleted-list"><li>而 SMTP 则把所有报文对象放在一个报文之中；</li></ul></li></ul></li></ol></details></li></ul><p id="7edf166e-4535-4b2c-9cb9-5d1db808cd32" class="">
</p></details></li></ul><h1 id="86f41780-79e0-4ff4-9188-e16aaf979946" class="">五、邮件报文格式和 MIME</h1><figure id="435aeb6c-fe47-45ae-8794-13d389875bd3" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image71.png"><img style="width:384px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image71.png"/></a></figure><ul id="3527c241-91d1-4483-ad7e-d8a3b8d51b3f" class="toggle"><li><details open=""><summary>邮件报文格式</summary><figure id="06046358-cf40-497d-8df4-f1c0cc1f8a6a" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image72.jpeg"><img style="width:439px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image72.jpeg"/></a></figure><ul id="3eeb736a-4111-48ad-8280-584247ca5618" class="bulleted-list"><li>邮件报文的首部有包含环境信息的首部行，首部行和报文体之间使用空行即回车换行进行分割；</li></ul><ul id="2477638a-0e97-491c-9421-ad4b960be22a" class="bulleted-list"><li>首部行(由关键词后跟冒号及其值组成)：<ul id="30acb12e-51d3-479f-9f51-60c2a13fef15" class="bulleted-list"><li>必须包含一个“From：”首部行和一个“To：”首部行</li></ul><ul id="4b3603ea-d99b-4794-b5fa-7c8d7449a4d6" class="bulleted-list"><li>可选包含一个“Subject：”首部行</li></ul></li></ul><ul id="d76a3346-0694-4716-9bd9-f14cb2d9613c" class="bulleted-list"><li>邮件报文注意事项：<ul id="4c059670-eca6-4cc7-a025-125e0a72daec" class="bulleted-list"><li>邮件报文中的首部行与 SMTP 协议中的“MAIL FROM：”和“RCPT TO：”等看似相似的命令截然不同：<ul id="95c1db12-b025-4f01-a375-d07ad61b389b" class="block-color-red bulleted-list"><li>SMTP 协议中的是基于 TCP 协议的 SMTP 协议握手的一部分操作；</li></ul><ul id="13b9777d-8c61-437d-9a43-58d23118b3ff" class="block-color-red bulleted-list"><li>邮件报文中的首部行仅仅是邮件报文自身的一部分；</li></ul></li></ul></li></ul></details></li></ul><ul id="a7e0577f-a024-491f-a88d-fead458c0e88" class="toggle"><li><details open=""><summary>MIME(多媒体邮件扩展协议)</summary><p id="4042bb6f-21b8-45da-8d12-263148f82d7d" class="">通过在首部行中添加条目声明“MIME”的文本内容</p><figure id="5b58b587-dfed-4f0c-bc92-431270872a80" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image73.png"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image73.png"/></a></figure><ul id="d3368877-1ce1-43fc-ab53-a224ff0c390c" class="bulleted-list"><li>MIME 数据类型/子类型/参数：<figure id="b25faae3-5f3b-41b2-9697-9c661229bbef" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image74.jpeg"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image74.jpeg"/></a></figure></li></ul><ul id="16244f80-9400-43a6-af57-9946239b4802" class="bulleted-list"><li>示例<p id="9d8e37a6-3ab0-4e0b-b0cf-4289d1ec0fc9" class="">如果在一个邮件报文内传输了多种数据类型的数据，应该：<div class="indented"><figure id="fcb872df-6c41-4e1c-9548-b8b5f878a337" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image75.png"><img style="width:384px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image75.png"/></a></figure><ul id="aeea4464-8038-4c78-a3bd-d494c5fd7f87" class="bulleted-list"><li>先在顶级首部行中声明为“混杂数据类型”，并且声明边界字符串</li></ul><ul id="fac15f02-87fd-44c3-8cf2-f2480b6437a6" class="bulleted-list"><li>在报文体中使用边界分割不同类型的数据，并且在被分块的子报文体中有子首部行，再次声明其数据类型和编码方式</li></ul><ul id="5f9c20b8-ccf7-402f-9bea-95d3c29c3234" class="bulleted-list"><li>首部行和报文体直接的回车换行必须存在</li></ul></div></p></li></ul></details></li></ul><h1 id="fcd87002-6bd9-47cd-ba50-07833db1b4ab" class="">六、邮件访问协议</h1><ul id="4b69c90a-7b40-4dfe-873e-edf32b37c8ae" class="toggle"><li><details open=""><summary>邮件访问协议的引出</summary><p id="59b84d52-5e09-4702-a53b-59ae2eaee6b4" class="">接收方用户代理不能使用 SMTP 取回报文，因为取报文是一个拉操作，而SMTP 协议是一个推协议。必须通过引入一个特殊的邮件访问协议来解决这个难题，较为常用的有：第三版的邮局协议（Post Office Protocol-Version3，POP3）、因特网邮件访问协议（Internet Mail Access Protocol，IMAP）以及 HTTP。</p><figure id="77fc4515-ed06-4013-bcb8-f3ce0a27258e" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image76.jpeg"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image76.jpeg"/></a></figure></details></li></ul><ul id="60c741f2-e9df-4fbf-aa6d-4d85e7d14779" class="toggle"><li><details open=""><summary>POP3</summary><ul id="3ac237e3-2f0b-4430-b2c2-b0c7cce6120b" class="toggle"><li><details open=""><summary>工作流程</summary><p id="7281e77a-6ebd-4ef3-a01e-0ec1849f6c81" class="">当用户代理（客户）打开了一个到邮件服务器（服务器）端口 <strong>110 </strong>上的TCP 连接后，POP3 就开始工作了。随着建立 TCP 连接，POP3 按三个阶段进行工作，特许、事务处理及更新。</p><ul id="43beebe1-98d1-4051-ba99-57d3d0ba63b5" class="bulleted-list"><li>在第一个阶段即<strong>特许阶段</strong>，用户代理发送（<strong>以明文形式</strong>）用户名和口令以鉴别用户；</li></ul><ul id="63041f01-97a7-46aa-840f-d943c824b347" class="bulleted-list"><li>在第二个阶段即<strong>事务处理阶段</strong>，用户代理取回报文(retr)；同时在这个阶段用户代理还能进行如下操作，对报文做删除标记(dele)，取消报文删除标记，以及获取邮件的统计信息；</li></ul><ul id="d01b7c88-8222-4ee3-b6bf-33a5eaa2e736" class="bulleted-list"><li>在第三个阶段即<strong>更新阶段</strong>，它出现在客户发出了 quit 命令之后，目的是结束该 POP3 会话；这时，该邮件服务器删除那些被标记为删除的报文。</li></ul></details></li></ul><ul id="c100e910-f1c1-4410-8bd1-04ee7cb7faf2" class="toggle"><li><details open=""><summary>POP3 回应报文</summary><p id="d8e868ce-f602-44d6-8567-cf171119accd" class="">+OK（有时后面还跟有服务器到客户的数据），被服务器用来指示前面的命令是正常的</p><p id="3ba097eb-9d3a-4a02-b407-81086f93d51e" class="">-ERR，被服务器用来指示前面的命令出现了某些差错。<div class="indented"><figure id="23c10f77-c0b6-44fc-b3c7-65b1ae76a03d" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image77.jpeg"><img style="width:313px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image77.jpeg"/></a></figure></div></p></details></li></ul><ul id="e020d204-5543-4c21-b3ac-ec3c5c82f512" class="toggle"><li><details open=""><summary>示例</summary><ul id="02aad8c4-43d1-412c-985d-d4df67f8b285" class="bulleted-list"><li>用户代理首先请求邮件服务器列出所有存储的报文的长度；</li></ul><ul id="f664b32d-1bdf-4584-a9d2-ebc2fb1b239b" class="bulleted-list"><li>接着用户代理从邮件服务器取回并删除每封邮件，注意在特许阶段以后，用户代理仅使用四个命令：list、retr、dele 和 quit；</li></ul><ul id="b269e5d9-a089-42de-bee1-cad2c1604db1" class="bulleted-list"><li>在处理 quit 命令后，POP3 服务器进入更新阶段，从用户的邮箱中删除邮件 1 和 2；</li></ul></details></li></ul><ul id="0f7a998b-57ac-4bad-ac90-01cd575b3298" class="toggle"><li><details open=""><summary>POP3 事务处理的两种方式</summary><ul id="a1b0a962-d4fe-4ebe-808b-2eab1ab4bde1" class="bulleted-list"><li>下载并删除<p id="f570eff8-1612-4c0a-9f9a-b634171b6381" class="">接收方用户可能有多个用户代理，当在用户代理设备 A 接收某邮件后，在设备 B 上将不再收到该已读的邮件；</p></li></ul><ul id="13142632-e402-4984-8a86-ab8d9c7c4599" class="bulleted-list"><li>下载并保留<p id="34c9faba-7f02-4ebf-a4db-e405100b74df" class="">使用下载并保留方式，用户代理下载某邮件后，该邮件仍保留在邮件服务器上。这时，接收方用户就能通过不同的机器重新读取这些邮件；</p></li></ul></details></li></ul></details></li></ul><ul id="0526e237-2d74-4d8b-bb96-33e34e65148a" class="toggle"><li><details open=""><summary>IMAP(使用极少)</summary><p id="d1b84aa3-e1c3-40ed-af20-28d50080266d" class="">简单来说，IMAP 协议允许用户在接收方邮件服务器上采用<strong>层级文件夹</strong>的方式进行邮件管理，允许用户自定义对自己的邮件进行邮件分类；</p><ul id="948f0d49-6d2a-442e-a555-afdf89eb5668" class="bulleted-list"><li>当报文第一次到达服务器时，它与收件人的 INBOX 文件夹相关联。收件人则能够把邮件移到一个新的、用户创建的文件夹中，阅读邮件，删除邮件等。IMAP 协议为用户提供了创建文件夹以及将邮件从一个文件夹移动到另一个文件夹的命令。</li></ul><ul id="9bcd2c73-dbf1-4265-b988-3dd1b94f1995" class="bulleted-list"><li>IMAP 还为用户提供了在远程文件夹中查询邮件的命令，按指定条件去查询匹配的邮件。值得注意的是，与 POP3 不同，IMAP 服务器维护了IMAP 会话的<strong>用户状态信息</strong>，例如，文件夹的名字以及哪些报文与哪些文件夹相关联。</li></ul><ul id="434c2252-175e-4154-b193-dea410964c4e" class="bulleted-list"><li>IMAP 的另一个重要特性是它具有<strong>允许用户代理获取报文组件的命令</strong>。例如，一个用户代理可以只读取一个报文的报文首部，或只是一个多部分MIME 报文的一部分。</li></ul></details></li></ul><ul id="85e48fff-dc9e-4f67-9985-3134acfe57c2" class="toggle"><li><details open=""><summary>基于 web 的电子邮件</summary><p id="e26f26a3-fb51-4154-b554-cd97f90a2c3a" class="">用户代理即为普通浏览器，用户代理和邮件服务器之间使用 HTTP 协议进行通信，但是邮件服务器之间还是使用的 SMTP 协议</p></details></li></ul><h1 id="e06dce29-1929-4bc9-a7b5-b46d1c81b61c" class="">七、DNS：域名解析系统</h1><p id="4b9681ff-369e-4b53-b728-6f3b8409e82d" class="">因特网上的数不胜数的主机可以通过主机名和 IP 地址两种方式标识：</p><ol id="c7083a48-8a99-4295-a8fa-089889d58579" class="numbered-list" start="1"><li>主机名便于被人类记忆，但是主机名没有标识主机在因特网中的位置， 即不能使用主机名来寻址；</li></ol><ol id="db49784c-7c67-4dd9-a323-982d7cc9c8c8" class="numbered-list" start="2"><li>IP 地址可以被用来在网络上进行服务器的寻址，但是不便于记忆；因此，我们需要一种能进行主机名到 IP 地址转换的目录服务，即 DNS 系统。<mark class="highlight-red">主机名→ip的映射</mark></li></ol><ul id="d0a78c3f-2826-496a-9d4d-afed95745905" class="toggle"><li><details open=""><summary>DNS 提供的服务</summary><ul id="44ddca9b-a00c-47b2-b62f-22500d7f40bb" class="toggle"><li><details open=""><summary>主机名到 IP 地址的转换</summary><p id="b2b12374-5309-455f-a8a2-1e51496fc12d" class="">当某个用户主机上的一个浏览器（ 即一个 HTTP 客户） 请求URL www.someschool.edu/index.html，为了使用户的主机能够将一个 HTTP 请求报文发 送 到 Web 服 务 器 www.someschool.edu ， 该 用 户 主 机 必 须 获 得www.someschool.edu 的 IP 地址。其做法如下：</p><ul id="9c0218ac-ed33-4da4-94da-6bc2ae831928" class="bulleted-list"><li>同一台用户主机上运行着 DNS 应用的客户端。</li></ul><ul id="eef89222-2527-4f34-afc3-89ebc5dcdaf9" class="bulleted-list"><li>浏览器从上述 URL 中抽取出主机名 <a href="http://www.someschool.edu/">www.someschool.edu</a>，并将这台主机名传给 DNS 应用的客户端。</li></ul><ul id="0b857751-0620-4274-9d66-a3f9d44af145" class="bulleted-list"><li>DNS 客户向 DNS 服务器发送一个包含主机名的请求。</li></ul><ul id="0e65212e-8f57-412c-8331-83935b7c19d5" class="bulleted-list"><li>DNS 客户最终会收到一份回答报文，其中含有对应于该主机名的 IP 地址。</li></ul><ul id="60cd0cd2-c33d-4a45-b19f-4a2d833ebd63" class="bulleted-list"><li>一旦浏览器接收到来自 DNS 的该 IP 地址，它能够向位于该 IP 地址 80 端口的 HTTP 服务器进程发起一个 TCP 连接。</li></ul></details></li></ul><ul id="4c5ee1d5-9a57-4e65-8f81-9d8ee2b96262" class="toggle"><li><details open=""><summary>主机别名</summary><p id="3733479c-7c35-4f6b-a095-1242b737ae88" class="">有着复杂主机名的主机能拥有一个或者多个别名。例如， 一台名为relayl.west-coast.enterprise.com 的主机，可能还有两个别名为 enterprise.com 和www.enterprise.com。在这种情况下，relayl.west-coast.enterprise.com 也称为规范主机名（canonical hostname）。主机别名（当存在时）比主机规范名更加容易记忆。应用程序可以调用 DNS 来获得主机别名对应的规范主机名以及主机的 IP 地址。</p></details></li></ul><ul id="46ef87bc-459d-4e19-b197-9d19f8193700" class="toggle"><li><details open=""><summary>邮件服务器别名</summary><p id="7f6ec8a7-d07e-4b57-a2bc-6f13807a8fa3" class="">类似主机别名，复杂的电子邮件服务器可以拥有别名。电子邮件应用程序可以调用 DNS，对提供的邮件服务器别名进行解析，以获得该主机的规范主机名及其 IP 地址。<strong>事实上，允许一个公司的邮件服务器和 Web 服务器使用相同（别名化的）的主机名；</strong>例如，一个公司的 Web 服务器和邮件服务器都能叫做enterprise.com。</p></details></li></ul><ul id="64e2c86a-bed6-4959-87d4-3ee68f0b09a0" class="toggle"><li><details open=""><summary>负载分配/负载均衡</summary><p id="8b6198d0-1329-4e84-8952-b2129d6920ab" class="">DNS 也用于在冗余的服务器（如冗余的 Web 服务器等）之间进行负载分配。繁忙的站点（如 cnn.com）被冗余分布在多台服务器上，每台服务器均运行在不同的端系统上，每个都有着不同的 IP 地址。由于存在冗余的Web 服务器，一个IP 地址集合与同一个规范主机名相联系。DNS 数据库中存储着这些 IP 地址集合。当客户对映射到某地址集合的名字发出一个 DNS 请求时，该服务器用 IP 地址的整个集合进行响应，但在每个回答中循环这些地址次序。因为客户通常总是向 IP 地址排在最前面的服务器发送 HTTP 请求报文，所以 DNS 就在所有这些冗余的 Web 服务器之间循环分配了负载。DNS 的循环同样可以用于邮件服务器，因此，多个邮件服务器可以具有相同的别名。</p></details></li></ul></details></li></ul><ul id="6d099d48-f6cb-414f-b076-5025c1700a40" class="toggle"><li><details open=""><summary>DNS 工作机理</summary><ul id="2320b238-8695-4b97-8451-b55fdbf77be0" class="toggle"><li><details open=""><summary>工作过程概述</summary><ul id="10309fc3-2e67-46d5-88c6-26ebcb75d9e9" class="bulleted-list"><li>假设运行在用户主机上的某些应用程序（如 Web 浏览器或邮件阅读器） 需要将主机名转换为 IP 地址。<strong>这些应用程序将调用 DNS 的客户端，并指明需要被转换的主机名</strong>；</li></ul><ul id="83608176-bb30-4b66-a219-e5f01c358025" class="bulleted-list"><li>用户主机上的DNS 客户端接收到后，向网络中发送一个 DNS 查询报文。所有的 DNS 请求和回答报文使用 UDP 数据报经端口 53 发送。</li></ul><ul id="7f999f76-c1d8-4f69-b602-9e775ea18402" class="bulleted-list"><li>经过若干毫秒到若干秒的时延后，用户主机上的 DNS 客户端接收到一个提供所希望映射的 DNS 回答报文。这个映射结果则被传递到调用 DNS 的应用程序。因此：<ol id="17c62fb3-3fd0-4cc2-bc51-ef4e2d9f275e" class="numbered-list" start="1"><li>从用户主机上调用应用程序的角度看，DNS 是一个提供简单、直接的转换服务的黑盒子；</li></ol><ol id="7f66ae6a-426c-4aa7-b8f9-600a0d4bba53" class="numbered-list" start="2"><li>但事实上，实现这个服务的黑盒子非常复杂，它由分布于全球的大量DNS 服务器以及定义了DNS 服务器与查询主机通信方式的应用层协议组成。</li></ol></li></ul></details></li></ul><ul id="b14838e9-5a48-4a51-8196-9c938e936933" class="toggle"><li><details open=""><summary>单点 DNS 架构（了解）</summary><p id="414c6c7a-645d-4034-9e64-d37c220e4d12" class="">在因特网上只使用一个 DNS 服务器，该服务器包含所有的映射。在这种集中式设计中，客户直接将所有查询直接发往单一的 DNS 服务器，同时该 DNS 服务器直接对所有的查询客户做出响应。很明显，这种集中式设计的问题包括：</p><ul id="785f577f-ce3c-4b47-8950-18a1370fb22f" class="bulleted-list"><li><strong>单点故障（a single point of failure）：</strong>如果该 DNS 服务器崩溃，整个因特网随之瘫痪</li></ul><ul id="8b4e2589-a1b3-46c1-b1e6-ae902567ed55" class="bulleted-list"><li><strong>通信容量（traffic volume）：</strong>单个 DNS 服务器不得不处理所有的 DNS 查询（用于为上亿台主机产生的所有HTTP 请求报文和电子邮件报文服务）。</li></ul><ul id="5bfdd796-6006-4484-a691-68d9a41ceda5" class="bulleted-list"><li>远距离的集中式数据库（distant centralized database）：单个 DNS 服务器不可能“邻近”所有查询客户。如果我们将单台 DNS 服务器放在纽约市， 那么所有来自澳大利亚的查询必须传播到地球的另一边，中间也许还要经过低速和拥塞的链路。这将导致严重的时延。</li></ul><ul id="0e5530c2-aa70-4baf-9a6e-f19c7b823304" class="bulleted-list"><li><strong>维护（maintenance）：</strong>单个 DNS 服务器将不得不为所有的因特网主机保留记录。这不仅将使这个中央数据库非常庞大，而且它还不得不为解决每个新添加的主机而频繁更新。</li></ul></details></li></ul><ul id="243cc3c4-04cd-4681-b347-5030202bb322" class="toggle"><li><details open=""><summary>分布式、层次数据库</summary><p id="915416a1-c609-4100-b128-d41cf676b99d" class="">DNS 使用了大量的 DNS 服务器，它们以层次方式组织，并且分布在全世界范围内。没有一台 DNS 服务器拥有因特网上所有主机的映射，相反，该映射分 布在所有的 DNS 服务器上。大致说来，有 3 种类型的 DNS 服务器：根 DNS 服务器、顶级域（Top-Level Domain，TLD）DNS 服务器和权威 DNS 服务器。</p><figure id="67dadada-9936-45b2-a1c9-cbfdc2c2472f" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image78.jpeg"><img style="width:639px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image78.jpeg"/></a></figure><ul id="b243049b-d400-4459-baac-9e73b31330b0" class="toggle"><li><details open=""><summary>根 DNS 服务器:</summary><p id="2c7ee046-521b-469f-8106-072b9c4466ae" class="">在因特网上有 13 个根 DNS 服务器（标号为 A 到 M），它们中的大部分位于北美洲。根 DNS 服务器就类比 114 查号台，保存有一级(顶级)单位的联系方式。尽管我们将这 13 个根DNS 服务器中的每个都视为单个的服务器，但每台“根服务器”实际上是一个冗余服务器的网络，即每个根服务器都不是一台服务器而是一个<strong>服务器集群</strong>，以提供安全性和可靠性。<mark class="highlight-red">记录顶级域服务器和顶级域服务器IP的对应关系。</mark></p></details></li></ul><ul id="aeae6ea4-7f29-4601-a028-85f024f90920" class="toggle"><li><details open=""><summary>顶级域（DNS）服务器:</summary><p id="9807b915-2278-4803-ab79-7e145a596b91" class="">这些服务器负责顶级域名如 com、org、net、edu 和 gov，以及所有国家的顶级域名如 uk、r、ca 和 jp。顶级域 DNS 服务器类比于哈尔滨工业大学(威海)， 这在 114 查号台看来，这是一个社会上的一级单位。同理，顶级域 DNS 服务器也类似于根 DNS 服务器的冗余服务器网络，例如com DNS 服务器也是一个拥有很大数量的服务器的网络集群，用来预防单点故障，同时考虑负载均衡。另外，顶级域 DNS 服务器可以有下属的子顶级域 DNS 服务器，例如 comDNS 服务器下属可能有多个<strong>集群</strong>，每个集群专门对应一些国家和地区，由此进行国家和地区访问的分流。<mark class="highlight-red">记录权威服务器和权威服务器IP的对应关系。</mark></p></details></li></ul><ul id="2d148019-bf7a-4883-bb44-f99158b3b21e" class="toggle"><li><details open=""><summary>权威 DNS 服务器:</summary><p id="3fa88242-ccd0-4064-981b-ab97f6f9ea99" class="">在因特网上具有公共可访问主机（如 Web 服务器和邮件服务器）的每个组织机构必须提供公共可访问的 DNS 记录，这些记录将这些主机的名字映射为 IP 地址。一个组织机构的权威 DNS 服务器收藏了这些 DNS 记录。一个组织机构能够选择实现它自己的权威 DNS 服务器以保存这些记录；另一种方法是，该组织能够支付费用，让这些记录存储在某个服务提供商的一个权威 DNS 服务器中。多数大学和大公司实现和维护它们自己基本和辅助（备份）的权威 DNS 服务器。权威 DNS 服务器类比于哈尔滨工业大学(威海)下属计算机学院，管理某个权威机构的多个服务器 IP 地址和多个主机名之间的对应关系。<mark class="highlight-red">记录目的服务器和目的服务器IP的对应关系。</mark></p><p id="003d7f77-4382-4ae6-9804-936e5069dd6c" class="">另外，权威 DNS 服务器可以有下属的子权威 DNS 服务器，例如雅虎 DNS 服务器下属可能有多个集群，每个集群专门对应一类服务信息，例如体育类信息、财经类信息等，由此进行不同类型查询访问的分流。</p></details></li></ul><ul id="ed7a9cd3-b30a-46bb-b3e4-5b031b1d9235" class="toggle"><li><details open=""><summary>本地名称服务器</summary><p id="adf8c912-a46f-4256-9b5f-df0aaa7affc5" class="">一个本地 DNS 服务器严格说来并不属于 DNS 服务器的层次结构，但它对DNS 层次结构是重要的。每个 ISP（如一个大学、一个系、一个公司或一个居民区的 ISP）都有一台本地 DNS 服务器（也叫默认名字服务器）。通过访问 Windows 或 UNIX 的网络状态窗口，能够容易地确定你本地 DNS 服务器的 IP 地址。主机的本地DNS 服务器通常地理上“邻近”本主机。当主机发出DNS 请求时， 该请求被发往本地 DNS 服务器，它起着代理的作用，并将该请求转发到 DNS 服务器层次结构中。</p></details></li></ul><ul id="f7682e7c-e352-4d3e-bd6f-361bbf2632a1" class="toggle"><li><details open=""><summary>示例</summary><figure id="4ee8571e-6c88-442a-9cf3-c0eea75d28f0" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image79.png"><img style="width:336px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image79.png"/></a></figure><ol id="866d58e0-6017-40f2-8233-aa41e3360734" class="numbered-list" start="1"><li><strong>王经理(要进行网络连接的应用)</strong>要查找<strong>刘扬(目的服务器)</strong>的<strong>电话(IP)</strong>，通知公司行政秘书(本地 DNS 服务器)查找；</li></ol><ol id="19ef181c-b0ca-4f62-ada8-468762b764b0" class="numbered-list" start="2"><li><strong>行政秘书(本地 DNS 服务器)</strong>作为中转，拿着<strong>“哈工大威海计算机学院刘扬老师”(目的服务器域名)</strong>这个名目先去询问 <strong>114 拨号台(根 DNS 服务器)</strong>，114 告诉行政秘书<strong>哈工大威海(顶级 DNS 服务器)</strong>的<strong>联系方式(顶级 DNS 服务器 IP 地址)</strong>；</li></ol><ol id="ae09ceb5-3949-4174-b571-a77e34784e81" class="numbered-list" start="3"><li>行政秘书(本地 DNS 服务器)得知后，继续联系哈工大威海(顶级 DNS 服务器)询问“哈工大威海计算机学院刘扬老师”( 目的服务器域名)的电话(IP)，哈工大威海(顶级 DNS 服务器)告诉行政秘书(本地 DNS 服务器)计算机学院(权威 DNS 服务器)的联系方式(权威 DNS 服务器 IP 地址)；</li></ol><ol id="563266f9-a791-48f3-affa-9479770f7aeb" class="numbered-list" start="4"><li><strong>行政秘书(本地 DNS 服务器)</strong>继续联系哈工大威海计算机学院(权威 DNS 服务器)询问“哈工大威海计算机学院刘扬老师”(目的服务器域名)的电话(IP)，哈工大威海计算机学院(权威 DNS 服务器) 告诉行政秘书(本地DNS 服务器)刘扬老师(目的服务器)的联系方式(目的服务器 IP 地址)</li></ol><ol id="68cda631-29f3-4af2-86c1-713b0f7ba872" class="numbered-list" start="5"><li><strong>行政秘书(本地DNS 服务器)</strong>告诉<strong>王经理(要进行网络连接的应用)“哈工大威海计算机学院刘扬老师”(目的服务器域名)</strong>的<strong>联系方式(IP 地址)</strong></li></ol></details></li></ul></details></li></ul></details></li></ul><ul id="2b3dd170-b842-4be5-ac23-49869d158602" class="toggle"><li><details open=""><summary>DNS 查询方式和DNS 缓存</summary><figure id="fcd43bd1-e309-442f-a673-f3cf79517d6c" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image80.jpeg"><img style="width:192px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image80.jpeg"/></a></figure><ul id="4501eeb2-4beb-495a-9859-00a54b882bc3" class="bulleted-list"><li>迭代查询（踢皮球）:一个 DNS 服务器发出一个查询，紧接着收到回复，再发出一个查询随后又收到回复……如此反复的过程就是迭代查询。例如上例中都是迭代查询；</li></ul><ul id="0de0974d-3379-409d-a827-c54144926b2d" class="bulleted-list"><li>递归查询（熟人）:发出一个 DNS 查询，DNS 服务器接收后，再次发出向<mark class="highlight-red">另一个 DNS 服务器</mark>查询的请求。如右图所示，整个 DNS 查询像一个栈；</li></ul><ul id="3b59c429-b294-47da-88a6-ba6764f15258" class="bulleted-list"><li>DNS 缓存: 缓存了根名称服务器、顶级域名称服务器、权威名称服务器以及域名和 IP 的映射关系。类似于 web cache 和ARP 表的缓存机制，就是为了提高 DNS 查询速度和效率。<ul id="9ac4af65-bc35-4e68-9604-abeb8ac42043" class="bulleted-list"><li>原理<ul id="f4b13d16-a1e8-4d53-b28f-aa3f03762fd4" class="bulleted-list"><li>在一个请求链中，当某 DNS 服务器接收一个DNS 回答时，它能将该回答中的信息缓存在本地存储器中。例如，在上图中，每当本地 DNS 服务器从某个 DNS服务器接收到一个回答，它能够缓存包含在该回答中的任何信息。</li></ul><ul id="70c21c4b-3045-4ddc-8a9b-842a855fc4ed" class="bulleted-list"><li>如果在 DNS 服务器中缓存了一台主机名/IP 地址对，另一个对相同主机名的查询到达该 DNS 服务器时，该 DNS 服务器就能够迅速的提供所要求的 IP 地址。<p id="16510cc1-c689-42f1-a848-a425173401d3" class="">由于主机和主机名与 IP 地址间的映射并不是永久的，DNS 服务器在一段时间后（通常设置为两天）将丢弃缓存的信息。</p></li></ul></li></ul></li></ul></details></li></ul><ul id="d12b7104-033e-4e5d-9411-5a606c6e240f" class="block-color-red toggle"><li><details open=""><summary>DNS 记录</summary><ul id="ee3716ef-fe62-4e14-baba-288b42e122a6" class="toggle"><li><details open=""><summary>DNS 记录:共同实现 DNS 分布式数据库的所有 DNS 服务器存储了资源记录（ResourceRecord，RR），RR 提供了主机名到 IP 地址的映射。每个 DNS 回答报文包含了一条或多条资源记录。资源记录是一个包含了下列字段的 4 元组：
（𝑵𝒂𝒎𝒆，𝑽𝒂𝒍𝒖𝒆，𝑻𝒚𝒑𝒆，𝑻𝑻𝑳）TTL 是该记录的生存时间，它决定了资源记录应当从缓存中删除的时间。</summary><ul id="94625d91-d11c-4c78-8c8c-6aac8242df04" class="bulleted-list"><li><strong>如果</strong>𝑻𝒚𝒑𝒆 = 𝑨，则 Name 是主机名，Value 是该主机名对应的 IP 地址。例如
<em>（</em>𝑟𝑒𝑙𝑎𝑦𝑙. 𝑏𝑎𝑟. 𝑓𝑜𝑜. 𝑐𝑜𝑚<em>，</em>145.37.93.126<em>，</em>𝐴<em>）</em>就是一条类型 A 记录</li></ul><ul id="b9b276f7-cdac-4796-bc98-3b8ddb959b32" class="bulleted-list"><li><strong>如果</strong>𝑻𝒚𝒑𝒆 = 𝑪𝑵𝑨𝑴𝑬，则 Value 是别名为 Name 的主机对应的规范主机名。该记录能够向查询的主机提供一个主机名对应的规范主机名，例如
<em>（</em>𝑓𝑜𝑜. 𝑐𝑜𝑚<em>，</em>𝑟𝑒𝑙𝑎𝑦𝑙. 𝑏𝑎𝑟. 𝑓𝑜𝑜. 𝑐𝑜𝑚<em>，</em>𝐶𝑁𝐴𝑀𝐸<em>）</em>就是一条 CNAME 类型的记录</li></ul><ul id="6bf9438f-ab84-4761-8e76-23b086004967" class="bulleted-list"><li><strong>如果</strong>𝑻𝒚𝒑𝒆 = 𝑵𝑺，则 Name 是个域名（如 foo.com），而 Value 是个知道如何获得解析该域名的 DNS 服务器的主机名。这个记录用于沿着查询链来路由 DNS 查询。例如<em>（</em>𝑓𝑜𝑜. 𝑐𝑜𝑚<em>，</em>𝑑𝑛𝑠. 𝑓𝑜𝑜. 𝑐𝑜𝑚<em>，</em>𝑁𝑆<em>）</em>就是一条类型为 NS 的记录，一般也会附带一条ip</li></ul><ul id="85dcd3e2-84bb-4244-a60a-a5643d9e3a14" class="bulleted-list"><li><strong>如果</strong>𝑻𝒚𝒑𝒆 = 𝑴𝑿，则 Value 是别名为Name 的邮件服务器的规范主机名。举例来说，<em>（</em>𝑓𝑜𝑜. 𝑐𝑜𝑚<em>，</em>𝑚𝑎𝑖𝑙. 𝑏𝑎𝑟. 𝑓𝑜𝑜. 𝑐𝑜𝑚<em>，</em>𝑀𝑋<em>）</em>就是一条 MX 记录。<p id="1ece6b78-ca9c-4ea4-8dc7-e0331209048a" class="">通过使用 MX 记录，一个公司的邮件服务器和其他服务器（如它的 Web 服务器）可以使用相同的别名。为了获得邮件服务器的规范主机名，DNS 客户应当请求一条 MX 记录；而为了获得其他服务器的规范主机名，DNS 客户应当请求 CNAME 记录。</p></li></ul></details></li></ul><ul id="a36afe57-2b41-412e-ae6e-07b76d93dd09" class="toggle"><li><details open=""><summary>在 DNS 层次结构查询 <a href="http://www.hitwh.edu.cn/">www.hitwh.edu.cn</a> 的 IP 地址</summary><ul id="19a87623-0df4-46e6-bd01-c9c607a7de49" class="bulleted-list"><li><strong>到根名称服务器上查找能解析.CN 的顶级域的域名</strong><figure id="169d640d-a7cd-4645-9aaf-03ffd5bf5a02" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image81.jpeg"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image81.jpeg"/></a></figure></li></ul><ul id="f857b22c-b921-4ff8-87bc-d3ec3da993a5" class="bulleted-list"><li><strong>到顶级域名称服务器上查找能解析 edu.cn 的顶级域的子域域名</strong><figure id="ef0e689f-cf4b-4115-9f83-2cfde85394c0" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image82.jpeg"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image82.jpeg"/></a></figure></li></ul><ul id="d2e60045-d854-43ec-a50d-1839e1abaf8d" class="bulleted-list"><li><strong>到顶级域名称服务器查找能解析 hitwh.edu.cn 权威名称服务器的域名</strong><figure id="0d4154b1-bb9d-46e6-8d2b-a23642d5cafd" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image83.jpeg"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image83.jpeg"/></a></figure></li></ul><ul id="2eb5e561-9e87-4b9e-a5f0-52cf208e6080" class="bulleted-list"><li><strong>到权威名称服务器上查找 </strong><a href="http://www.hitwh.edu.cn/"><strong>www.hitwh.edu.cn</strong></a><strong> 的 A 类型（对应的 IP）</strong><figure id="75a06ad4-2f25-4e30-a6f8-56e1ee925a16" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image84.jpeg"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image84.jpeg"/></a></figure></li></ul><ul id="642b0d20-79d5-448e-9ccd-941dac1fdef1" class="bulleted-list"><li><strong>验证 </strong><a href="http://www.hitwh.edu.cn/"><strong>www.hitwh.edu.cn</strong></a><strong> 的 IP 映射</strong><figure id="e8c33a02-f890-42f3-b12a-6d4630e9cef7" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image85.jpeg"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image85.jpeg"/></a></figure></li></ul></details></li></ul><ul id="1936e0e6-b402-4602-86aa-36c7602d9a15" class="toggle"><li><details open=""><summary>在本地名称服务器上查询记录</summary><p id="38309f3b-bd1f-4b9e-af99-9048c5ea88e2" class="">使用𝑛𝑠𝑙𝑜𝑜𝑘𝑢𝑝命令查询时，如果不指定查询的服务器，则默认向本地名称服务器查询。因此只需要把上述命令中指定的查询 DNS 服务器去掉即可。即在本地 DNS 服务器的缓存中查找之前是否已经存在这些主机名到 IP 的映射；山东本地 DNS 服务器：202.102.154.3、202.102.152.3、202.102.128.68、202.102.134.68</p><figure id="2da5fbc9-0d75-46ee-9f4c-181daa9415a7" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image86.jpeg"><img style="width:496px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image86.jpeg"/></a></figure><figure id="6e5b82ca-100e-49c5-8b76-da58fb3b9d81" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image87.jpeg"><img style="width:469px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image87.jpeg"/></a></figure><figure id="eba37b9d-15b1-4feb-bfbb-92256649e063" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image88.jpeg"><img style="width:574px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image88.jpeg"/></a></figure><figure id="90b79586-8eb5-4cb4-9e40-a4103bd2a9a9" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image89.jpeg"><img style="width:578px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image89.jpeg"/></a></figure></details></li></ul><ul id="41e6b18f-df97-436d-b76a-faff12bf8e94" class="toggle"><li><details open=""><summary>DNS 的记录创建</summary><p id="1f89f847-888a-4a5b-a16d-3788c6e25676" class="">我们在一个特定的例子中看看这是如何完成的。假定你刚刚创建一个称为网络乌托邦（Network Utopia）的令人兴奋的新创业公司。你必定要做的第一件事是在注册登记机构注册域名 networkutopia.com。</p><ul id="9bb53cbe-4e70-442d-b86b-fb5e0cec7292" class="bulleted-list"><li>创建好 web 服务后，部署到搭建好的服务器后，将服务器的主机名和 IP地址写到权威名称服务器上；</li></ul><ul id="0ac00973-d01b-43e8-9503-b6211ddb7b27" class="bulleted-list"><li>当你向某些注册登记机构注册域名 networkutopia.com 时，需要向该机构提供你的基本和辅助权威 DNS 服务器的名字和 IP 地址；</li></ul><ul id="788d87ce-62f3-429f-83c3-5c0b1275a606" class="bulleted-list"><li>该注册登记机构确保将一个类型 NS 和一个类型 A 的记录输入 TLD com 服务器。特别是对于用于 networkutopia.com 的基本权威服务器，该注册登记机构将下列两条资源记录插入该 DNS 系统中：<figure id="817fa6c8-b8ee-4c29-8e7a-489cefd84f73" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image90.jpeg"><img style="width:448px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image90.jpeg"/></a></figure></li></ul></details></li></ul></details></li></ul><h1 id="a3842d10-d74e-436c-8e6e-f96eec89f4ee" class="">八、P2P 文件分发(了解)</h1><ol id="7582b75b-4704-49cd-8b07-7d1715184b3d" class="numbered-list" start="1"><li>概述<ul id="c062409c-f0ce-49fb-9c4f-916fb4e3844a" class="toggle"><li><details open=""><summary>纯 P2P 架构</summary><ul id="f3dd856e-0641-4ee0-8673-eeaf9a331013" class="bulleted-list"><li>没有一个总是运行的服务器，对总是打开的基础设施服务器有最小的（或者没有）依赖</li></ul><ul id="6f606ed0-c308-4c1c-bdff-10ac312e207a" class="bulleted-list"><li>任何两个端系统之间可以逻辑连接、直接通信</li></ul><ul id="bebae626-f199-4a36-a98e-069e18e8c1a1" class="bulleted-list"><li>对等点之间可以间接连接和更改其 IP 地址，这些对等方并不为服务提供商所拥有，而是受用户控制的桌面计算机和膝上计算机</li></ul></details></li></ul><ul id="491d96f4-d4f3-4705-ba01-8a3d4c96fb9b" class="toggle"><li><details open=""><summary>文件分发：C/S 架构 vs P2P</summary><ul id="6ba1c03d-2154-4ef5-8e52-17447c3271dc" class="bulleted-list"><li>从单一服务器向大量主机（称为对等方）分发一个大文件：</li></ul><ul id="b8e8de8a-8c9f-4fc8-b038-83f3a48daf34" class="bulleted-list"><li>在 C/S 文件分发中，该服务器必须向每个对等方发送该文件的一个副本， 即服务器承受了极大的负担，并且消耗了大量的服务器带宽。</li></ul><ul id="511d5fdd-609e-40c4-96a8-4439e8516dc9" class="bulleted-list"><li>在 P2P 文件分发中，每个对等方能够重新分发它所有的该文件的任何部分，从而在分发过程中协助该服务器。</li></ul></details></li></ul></li></ol><ol id="7d4e9799-2d18-4751-9315-e178678990b2" class="numbered-list" start="2"><li>P2P 结构的扩展性<p id="e24537d5-97fd-4954-9c76-8d44a32de6eb" class="">分发时间：所有N个对等方得到文件的副本所需要的时间</p><figure id="f2f6eda4-05d7-4b20-a62e-cd9441ecf4b9" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image91.jpeg"><img style="width:480px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image91.jpeg"/></a></figure><p id="a567fb98-e15d-4c70-9b26-6342eb3c9514" class="">𝑈𝑠表示服务器上传速度，𝑑𝑖表示节点的下载速度，𝑢𝑖表示节点的上传速度，F 表示被分发的文件长度，N 表示要获得该文件副本的对等方的数量分发时间：所有 N 个对等方得到该文件的副本所需要的时间</p><ul id="d468cc1d-7de1-47dd-81ee-259e97db2d32" class="toggle"><li><details open=""><summary>对于 C/S 体系结构的分发时间</summary><figure id="aeb44d57-1ced-4563-b6e1-f2af289737d7" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image92.jpeg"><img style="width:700px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image92.jpeg"/></a></figure></details></li></ul><ul id="70825194-43ea-424f-a42b-0a4d429e8fdc" class="toggle"><li><details open=""><summary>对于 P2P 体系结构的分发时间</summary><p id="1733f1bc-a2bf-4db9-8495-2af58ca77dee" class="">每个对等方能够帮助服务器分发该文件。特别是，当一个对等方接收到某些 文件数据，它能够使用自己的上载能力重新将数据分发给其他对等方。</p><ul id="e2d63877-280c-46da-88e6-14953a48180b" class="bulleted-list"><li>在分发的开始，只有服务器具有文件。为了使社区的这些对等方得到该文件，该服务器必须经其接入链路至少发送该文件的每个比特一次。因此，最小分发时间至少是𝑭/𝑼𝑺</li></ul><ul id="e877140d-32fc-420d-8232-a1ced0ff9f11" class="bulleted-list"><li>与客户-服务器体系结构相同，具有最低下载速率的对等方不能够以小于𝐹/𝑈𝑚𝑖𝑛秒的分发时间获得所有 F 比特。因此<strong>最小分发时间至少为</strong>𝑭/𝑼𝒎𝒊𝒏</li></ul><ul id="14fbd9e5-1f90-4c4e-9f2a-28cf2a9820dc" class="bulleted-list"><li><mark class="highlight-red">最后，观察到系统整体的总上载能力等于服务器的上载速率加上每个单独的对等方的上载速率</mark>，即𝑈𝑡𝑜𝑡𝑎𝑙 = 𝑈𝑆 + 𝑈1 + ⋯ + 𝑈𝑁。系统必须向这 N 个对等方的每个交付（上载）F 比特，因此总共交付 NF 比特。这不能以快于𝑈𝑡𝑜𝑡𝑎𝑙的速率完成。因此，<strong>最小的分发时间也至少是</strong>𝑵𝑭/𝑼𝒕𝒐𝒕𝒂𝒍</li></ul><figure id="20d24f19-bf62-40dd-bcbd-feb5c48210e4" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image93.jpeg"><img style="width:680px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image93.jpeg"/></a></figure></details></li></ul><ul id="cc751ad4-b7d9-46b5-9e1b-d5583e09c549" class="toggle"><li><details open=""><summary>P2P VS C/S</summary><figure id="7aeba21d-1d20-44d0-84d8-b32a04194a61" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image94.png"><img style="width:384px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image94.png"/></a></figure><ul id="b372fec4-3e95-45e9-a383-77ff8304eb83" class="bulleted-list"><li>对于客户-服务器体系结构，随着对等方数量的增加，分发时间呈线性增长并且没有界；</li></ul><ul id="837fe231-07fe-4ad2-bc9a-99588c183ffc" class="bulleted-list"><li>然而，对于 P2P 体系结构，最小分发时间不仅总是小于客户-服务器体系结构的分发时间，并且对于任意的对等方数量 N，总是小于一个确定的时间；</li></ul><p id="3732e47c-280e-49fd-97d7-c69c32248d50" class="">因此，具有 P2P 体系结构的应用程序能够是自扩展的。这种扩展性的直接成因是：对等方除了是比特的消费者外还是它们的重新分发者。</p></details></li></ul></li></ol><ol id="0536ef00-e33c-4413-9041-015c42d523d6" class="numbered-list" start="3"><li>BitTorrent<ul id="fae6af3f-d3d7-41f4-9776-579b62a9f93a" class="toggle"><li><details open=""><summary>定义</summary><p id="e775f20d-605a-4f5c-a9ca-d7b4cdde2ba3" class="">BitTorrent 是一种用于文件分发的流行 P2P 协议。参与一个特定文件分发的所有对等方的集合被称为一个洪流（torrent）。在一个洪流中的对等方彼此下载等长度的文件（chunk），典型的块长度为 256KB。当一个对等方首次加入一个洪流时，它没有块。随着时间的流逝，它累积了越来越多的块。当它下载块时，也为其他对等方上载了多个块。一旦某对等方获得了整个文件，它也许（自私地）离开洪流，或（大公无私地）留在该洪流中并继续向其他对等方上载块。同时，任何对等方可能在任何时候仅具有块的子集就离开该洪流，并在以后重新加入该洪流中。</p></details></li></ul><ul id="555f6c9f-828a-432f-b464-af86068a1569" class="toggle"><li><details open=""><summary>组成</summary><ul id="261ac1f0-90d1-41a1-9b43-24ac59a1860e" class="bulleted-list"><li>对等方<p id="5cdddb5f-6785-47f0-be49-123c35bc3c15" class="">一个给定的洪流可能在任何时刻具有数以百计或数以千计的对等方。</p></li></ul><ul id="a02d85d7-b0d6-4dca-90fe-6eb214580e16" class="bulleted-list"><li>追踪器（tracker）<p id="da311540-1b12-4c48-9b7c-5c587fc88c23" class="">每个洪流具有一个基础设施结点，称为追踪器（tracker）。当一个对等方加入某洪流时，它向追踪器注册自己，并周期性地通知追踪器它仍在该洪流中。以这种方式，追踪器跟踪正参与在洪流中的对等方。</p><figure id="c34a5206-29ed-4829-af3a-c8222956fa95" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image95.jpeg"><img style="width:384px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image95.jpeg"/></a></figure></li></ul></details></li></ul><ul id="70f2135e-7151-40b1-9280-4fc7e409de82" class="toggle"><li><details open=""><summary>新对等方的加入</summary><p id="390f29d3-54bf-49a6-9fcb-7f7ca17a312c" class="">如上图所示，当一个新的对等方 Alice 加入该洪流时，追踪器随机地从参与对等方的集合中选择对等方的一个子集，并将这 50 个对等方的 IP 地址发送给Alice。Alice 持有对等方的这张列表，试图与该列表上的所有对等方创建并行的 TCP 连接。我们称所有这样与 Alice 成功地创建一个 TCP 连接的对等方为“邻近对等方”（在上图中，Alice 显示了仅有三个邻近对等方。通常，她应当有更多的对等方）。随着时间的流逝，这些对等方中的某些可能离开，其他对等方（最初 50 个以外的）可能试图与 Alice 创建 TCP 连接。因此一个对等方的邻近对等方将随时间而波动。</p></details></li></ul><ul id="aa5cf5f0-3826-47bb-9f26-340bffe1770a" class="toggle"><li><details open=""><summary>对等方在洪流网络中的动作</summary><p id="e1dd5eb7-b560-4872-aacd-4d311a85386a" class="">在任何给定的时间，每个对等方将具有来自该文件的块子集，并且不同的对等方具有不同的子集。对等方周期性地（经 TCP 连接）询问每个邻近对等方它们所具有的块列表。如果某对等方具有 L 个不同的邻居，其将获得 L 个块列表。有了这个信息， 某对等方将对它当前还没有的块发出请求（仍通过 TCP 连接）。</p></details></li></ul><ul id="edfe557d-c107-4984-bcc1-ea77295c66bb" class="toggle"><li><details open=""><summary>对等方的请求/响应策略</summary><p id="70e1ff3e-c350-4ecb-9144-a032892b76d0" class="">因此在任何给定的时刻，某个对等方将具有块的子集并知道它的邻居具有哪些块。利用这些信息，该对等方将作出两个重要决定：</p><ol id="64a090d9-41ea-4a3f-832f-1b24eb626af9" class="numbered-list" start="1"><li>对于自己缺少的块，对等方应当从她的邻居请求哪些块；</li></ol><ol id="00a76fda-7cbc-4e17-a4a0-1883babd74f1" class="numbered-list" start="2"><li>对于向自己发起请求的邻居，对等方应该响应哪一个；</li></ol><ul id="ea79195b-d166-44d0-962b-bf48c526595d" class="toggle"><li><details open=""><summary>最稀缺优先（rarest first）</summary><p id="ef28ab47-24ea-42ca-b4e3-d23799185953" class="">对等方针对其没有的块在她的邻居中查找最稀缺的块（最稀缺的块就是那些在她的邻居中副本数量最少的块），并首先请求那些最稀缺的块。这样，最稀缺块得到更为迅速的重新分发，其目标是均衡每个块在洪流中的副本数量。 即邻居中哪些块少先请求哪些，这样这些这些稀缺的块在整个洪流网络中就 会拥有多个副本，均衡了所有块副本数量。</p></details></li></ul><ul id="f427d0ce-3ccf-47c3-9022-cda9afc6c84a" class="toggle"><li><details open=""><summary>对换算法</summary><p id="7533dc50-39b4-47de-9439-48d1c36ac497" class="">对等方根据当前能够以最高速率向自己提供数据的邻居，优先对其发来的请 求进行响应。特别是，对等方持续地测量自己的每个邻居向自己发送块的比特速率，并确定以最高速率流入的 4 个邻居。每过 10 秒，她重新计算该速率并可能修改这 4 个对等方的集合。</p><p id="61b854c1-a02d-4735-954f-ac7cf4b52d62" class="">每过 30 秒 Alice 将随机地选择一名新的对换伴侣并开始与那位伴侣进行对换。如果这两名对等方都满足此对换，它们将对方放入其前 4 位列表中并继续与对方进行对换，直到该对等方之一发现了一个更好的伴侣为止。</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="11706db2-ece8-435a-b1ab-ca05910683d6"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">注释：每过 30 秒，对等方 Alice 也要随机地选择另外一个邻居并向其发送块。我们将这个被随机选择的对等方称为 Bob。因为 Alice 正在向 Bob 发送数据，她可能成为 Bob 前 4 位上载者之一，这样的话 Bob 将开始向 Alice 发送数据。如果 Bob 向 Alice 发送数据的速率足够高，Bob 接下来也能成为Alice 的前 4 位上载者。</div></figure><p id="6f008ac0-8f8e-4a69-a74c-0fd53aa22099" class="">这种效果是对等方能够以趋向于找到彼此的协调的速率上载。随机选择邻居也允许新的对等方得到块，因此它们能够具有对换的东西。除了这 5 个对等方（“前”4 个对等方和一个试探的对等方）的所有其他相邻对等方均被“阻塞”，即它们不能从 Alice 接收到任何块。</p></details></li></ul></details></li></ul></li></ol><h1 id="ee3de98f-844b-4741-be96-48a0d838dc6a" class="">九、TCP 套接字编程</h1><ul id="b9b353d5-2475-4b7d-9e66-ac10aa87dd8a" class="toggle"><li><details open=""><summary>定义</summary><p id="d2105a35-7abf-4a5c-b96d-76b7ea9c24e9" class="">客户端和服务器之间发送数据之前，它们先要握手和创建一个 TCP 连接。TCP 连接的一端与客户套接字相联系，另一端与服务器套接字相联系。当创建该TCP 连接时，我们将其与客户套接字地址（IP 地址和端口号）和服务器套接字地址（IP 地址和端口号）关联起来。使用创建的 TCP 连接，当一侧要向另一侧发送数据时，它只需经过其套接字将数据丢给 TCP 连接。TCP 套接子提供了可靠的、连续的并且有序的字节流的传输。</p></details></li></ul><ul id="185bf697-819c-4482-a827-036d483c95f4" class="toggle"><li><details open=""><summary>服务器为进行 socket TCP 通信必须做好的准备</summary><ul id="15960b73-99e3-4066-99bc-447f3573b184" class="bulleted-list"><li>TCP 服务器必须在客户端试图<mark class="highlight-red">发起请求之前运行起来</mark>；</li></ul><ul id="13cb1bca-43a0-4944-90b7-15e3b0a99fb5" class="bulleted-list"><li>服务器程序必须<mark class="highlight-red">创建好一个特殊的套接字</mark>(欢迎套接字)，该套接字类似于一个“欢迎之门”，接待任何首次试图与服务器进行通信的客户端的请求；</li></ul></details></li></ul><ul id="3a161dde-37e9-4c8a-95ed-bbb7d9cad478" class="toggle"><li><details open=""><summary>客户端为进行 socket TCP 通信必须做好的准备</summary><ul id="454f337d-5af6-4e1b-b8d1-578a820efad8" class="bulleted-list"><li>客户端创建本地 TCP 套接字；</li></ul><ul id="b9b0d445-d08e-4da8-b466-a2cebcf5fd16" class="bulleted-list"><li>该客户端本地 TCP 套接字指定了服务器中创建的“欢迎套接字”的地址和端口号，即<mark class="highlight-red">服务器主机的 IP 地址及其套接字的端口号</mark>；</li></ul><ul id="9e2f7583-8d9d-4ade-a7ba-2235b91ac4ea" class="bulleted-list"><li>生成套接字后，客户端发起三次握手并创建和服务器的 TCP 连接；</li></ul></details></li></ul><ul id="56949bcd-3efa-43cc-abd2-2af04d699431" class="toggle"><li><details open=""><summary>客户端和服务器建立 TCP 连接的过程</summary><p id="8f1b5836-1d34-4f3a-a223-9aa7346bca76" class="">在三次握手期间，客户进程敲服务器进程的欢迎之门。当该服务器“听”到敲门时，它将生成一扇新门（更精确地讲是一个新套接字），新生成的套接字专门用于指定的客户。<div class="indented"><figure id="d82263a6-1312-4b0a-b0fc-598a9e1887c6" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image96.jpeg"><img style="width:288px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image96.jpeg"/></a></figure></div></p><ul id="e0cebb45-1e21-4ccd-87fc-e0a155004d34" class="bulleted-list"><li>欢迎之门是一个我们称为server Socket 的TCP 套接字对象，<mark class="highlight-red">它专门对客户进行连接的新生成的套接字， 称为连接套接字（connection Socket）。</mark></li></ul><ul id="83adac5a-c663-41fb-9619-7d06a4fad4ec" class="bulleted-list"><li>欢迎套接字是所有要与服务器进行通信的客户的起始接触点</li></ul><ul id="99c1e05e-c9d8-4b58-a492-86a382fe4304" class="bulleted-list"><li>连接套接字是起始接触之后新生成的单独服务于每个客户通信生成的套接字</li></ul><ul id="e944c488-5d5b-4a1a-90ad-0737f1a3a69d" class="bulleted-list"><li><strong>当多个主机的多个进程同时向服务器进程进行 TCP 套接字请求：</strong><ul id="49881f79-0c6c-4bfc-93a2-5ac1295cd1fe" class="bulleted-list"><li>连接套接字的源 IP 和源端口号均不同，这是不同主机请求同一个服务器，客户端端口号是客户端随机分配的；</li></ul><ul id="5f2fc7fa-b822-4932-ab08-1e24bc7695f0" class="bulleted-list"><li>连接套接字的源 IP 不同和源端口号相同，这是不同主机请求同一个服务器，客户端端口号是客户端随机分配的；</li></ul><ul id="1c77aaa0-bf68-4a6b-80b7-d6868ef42d4c" class="bulleted-list"><li>连接套接字的源 IP 相同和源端口号不同，相同主机的不同进程和服务器的 TCP 通信；服务器端为了节约服务器资源，每次完成本次的连接之后就会关闭本次建立的 TCP 连接即连接套接字</li></ul><figure id="c297ce04-a988-4330-b479-fbc9308d1c02" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image97.jpeg"><img style="width:336px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image97.jpeg"/></a></figure></li></ul></details></li></ul><h1 id="cbf0bf63-d480-4fad-90a9-e65c14debc36" class="">十、UDP 套接字编程</h1><p id="1c356dcc-8e0d-4311-ab90-8f669c526c0e" class="">特点：在服务器和客户端之间无连接的通信服务<div class="indented"><ul id="a0a37654-a7fc-43a6-bf6b-b4cdf66b030a" class="bulleted-list"><li>无三次握手的通信可靠性确认；</li></ul><ul id="9e5a4393-90a2-417c-8d06-2720110812b0" class="bulleted-list"><li>发送方明确地将目标 IP 地址和端口号附加到每个数据包/分组；</li></ul><ul id="1aa61c45-50ea-4bf0-ae62-acdcb99c28af" class="bulleted-list"><li>服务器端没有“欢迎套接字”在等待连接，而且服务器端和客户端的运行先后顺序无所谓；</li></ul><ul id="45131a3e-4552-47e1-8f04-93fc69dbf83c" class="bulleted-list"><li>服务器必须从接收到的数据包中提取发送方的 IP 地址和端口号，以便于回复请求；</li></ul><ul id="8b6bb9c1-d807-4f9a-8fec-32ed96c324f0" class="bulleted-list"><li>通过 UDP 套接子传输的数据可能乱序接收或丢失；</li></ul><ul id="8525e180-7cb6-4163-8eb3-e344984996a0" class="bulleted-list"><li>UDP 在客户端和服务器之间提供了不可靠的字节组（“数据报”）传输；</li></ul><figure id="1f03e66a-8fa5-43f2-b286-b1c9e4123192" class="image"><a href="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image98.jpeg"><img style="width:629px" src="Untitled%200ad9cc5a6c1545f9815f10d244448f1d/image98.jpeg"/></a></figure></div></p></div></article></body></html>